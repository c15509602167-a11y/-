<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ç²¾é¦å¡”è®¾è®¡çš„å½±å“å› ç´ è§£æ</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      max-width: 1500px;
      margin: 0px auto;
      padding: 0 10px;
      background-color: #f8f9fa;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 0px;
    }
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 0px;
    }
    .main-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 15px;
    }
    .panel {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      height: 100%;
      box-sizing: border-box;
    }
    /* ç¬¬ä¸€è¡Œå„åˆ—æ ·å¼ - æ¢å¤åŸå§‹å®½åº¦æ¯”ä¾‹ */
    .tower-col {
      width: 28%; /* æ¢å¤åŸå§‹å®½åº¦ */
      vertical-align: top;
    }
    .mt-col {
      width: 52%; /* æ¢å¤åŸå§‹å®½åº¦ */
      vertical-align: top;
    }
    .param-col {
      width: 20%; /* æ¢å¤åŸå§‹å®½åº¦ */
      vertical-align: top;
    }
    /* ç¬¬äºŒè¡Œæ“æ§åŒºæ ·å¼ */
    .control-row {
      height: auto;
    }
    .control-panel {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: center;
      padding: 15px;
    }
    /* ç¬¬ä¸‰è¡Œæ•°æ®åŒºæ ·å¼ */
    .data-row {
      height: auto;
    }
    .data-panel {
      padding: 15px;
    }

    label {
      display: block;
      margin-top: 12px;
      font-weight: bold;
      color: #34495e;
    }
    input[type="range"] {
      width: 100%;
      accent-color: #3498db;
      cursor: pointer;
    }
    .result-box {
      margin-top: 0px;
      padding: 10px;
      background: #eef7ff;
      border-radius: 5px;
      font-family: monospace;
      font-size: 13px;
      line-height: 1.5;
      border-left: 3px solid #3498db;
    }
    .equation-box {
      margin-top: 10px;
      padding: 8px;
      background: #f0f8ff;
      border-left: 3px solid #3498db;
      font-family: monospace;
      font-size: 13px;
    }
    button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      background: #3498db;
      color: white;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    button:hover { 
      opacity: 0.9; 
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(52, 152, 219, 0.2);
    }
    button:disabled { 
      background: #ccc; 
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    .export-btn {
      background: #27ae60;
    }
    .study-btn {
      background: #e67e22;
    }
    .help-btn {
      background: #9b59b6;
    }
    .quiz-btn {
      background: #1abc9c;
    }
    svg {
      width: 100%;
      height: auto;
      background: #fff;
      border: 1px solid #eee;
      border-radius: 4px;
    }
    .tower-svg {
      max-width: 220px; /* æ¢å¤åŸå§‹å®½åº¦ */
      height: 590px;
      margin: 10px auto 0;
      display: block;
    }
    table.data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      font-size: 13px;
    }
    .data-table th, .data-table td {
      border: 1px solid #ddd;
      padding: 6px;
      text-align: center;
    }
    .data-table th {
      background-color: #e3f2fd;
      color: #2c3e50;
    }
    .data-table tr:hover td {
      background-color: #f8f9fa;
    }
    .warning {
      color: #e74c3c;
      font-weight: bold;
    }
    #feedStudyPlot {
      margin-top: 20px;
      padding: 15px;
      background: #fcf8e3;
      border-radius: 6px;
      border-left: 4px solid #f0ad4e;
    }
    .param-value {
      color: #2980b9;
      font-weight: normal;
      font-size: 13px;
      margin-left: 6px;
      padding: 1px 4px;
      background: #eef7ff;
      border-radius: 2px;
    }
    .param-note {
      font-size: 12px;
      color: #666;
      margin-top: -8px;
      margin-bottom: 8px;
    }
    h3.panel-title {
      color: #2c3e50;
      margin-top: 0;
      padding-bottom: 8px;
      border-bottom: 1px solid #eee;
      font-size: 1.1rem;
    }
    /* è¿›æ–™ä½ç½®åˆ†æç»“æœæ•°æ®è¡¨æ ·å¼ä¼˜åŒ– - å®½åº¦åŠ å¤§ä¸€å€ */
    #feedStudyPlot table {
      width: 100% !important;
      font-size: 14px !important;
      border-collapse: collapse !important;
      min-width: 600px; /* å¢åŠ æœ€å°å®½åº¦ç¡®ä¿è¡¨æ ¼è¶³å¤Ÿå®½ */
    }
    #feedStudyPlot th, #feedStudyPlot td {
      padding: 8px 12px !important; /* å¢åŠ å†…è¾¹è·ï¼Œè¡¨æ ¼æ›´èˆ’å±• */
      text-align: center !important;
      vertical-align: middle !important;
    }
    #feedStudyPlot th {
      background-color: #f0ad4e33;
      font-weight: bold;
    }
    #feedStudyPlot .table-container {
      max-height: 180px;
      overflow-y: auto;
      margin: 10px 0;
      width: 100%;
    }
    #feedStudyPlot .info-text {
      text-align: center;
      margin-bottom: 10px;
      color: #2c3e50;
      font-weight: 500;
    }
    #feedStudyPlot .note-text {
      text-align: center;
      margin-top: 10px;
      font-size: 12px;
      color: #666;
    }
    /* æµ‹éªŒæ¨¡æ€æ¡†æ ·å¼ */
    #quizModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 1001;
      justify-content: center;
      align-items: center;
      overflow-y: auto;
      padding: 20px 0;
    }
    #quizContent {
      background: white;
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 30px rgba(0,0,0,0.3);
    }
    .quiz-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid #1abc9c;
    }
    .quiz-header h2 {
      margin: 0;
      color: #2c3e50;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .quiz-close {
      background: #e74c3c;
      border: none;
      color: white;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .quiz-question {
      margin-bottom: 25px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #1abc9c;
    }
    .quiz-question h4 {
      margin: 0 0 12px 0;
      color: #2c3e50;
      font-size: 16px;
    }
    .quiz-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .quiz-option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .quiz-option:hover {
      background: #f0fdfa;
      border-color: #1abc9c;
    }
    .quiz-option input {
      width: 18px;
      height: 18px;
      accent-color: #1abc9c;
      cursor: pointer;
    }
    .quiz-option label {
      margin: 0;
      font-weight: normal;
      cursor: pointer;
      flex: 1;
    }
    .quiz-footer {
      display: flex;
      justify-content: center;
      margin-top: 30px;
      gap: 15px;
    }
    .quiz-btn-large {
      padding: 12px 30px;
      font-size: 16px;
      font-weight: 600;
    }
    .quiz-result {
      margin-top: 25px;
      padding: 20px;
      border-radius: 8px;
      display: none;
    }
    .result-pass {
      background: #d4edda;
      border: 1px solid #c3e6cb;
    }
    .result-fail {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
    }
    .quiz-result h3 {
      margin: 0 0 15px 0;
      text-align: center;
    }
    .result-pass h3 {
      color: #155724;
    }
    .result-fail h3 {
      color: #721c24;
    }
    .question-feedback {
      margin-top: 10px;
      padding: 12px;
      border-radius: 6px;
      display: none;
    }
    .feedback-correct {
      background: #e8f5e9;
      border: 1px solid #c8e6c9;
    }
    .feedback-incorrect {
      background: #ffebee;
      border: 1px solid #ffcdd2;
    }
    .question-feedback p {
      margin: 0;
      font-size: 14px;
    }
    .feedback-correct p {
      color: #2e7d32;
    }
    .feedback-incorrect p {
      color: #c62828;
    }
    .question-explanation {
      margin-top: 8px;
      padding: 10px;
      background: #f5f5f5;
      border-radius: 4px;
      font-size: 13px;
      color: #424242;
    }
  </style>
</head>
<body>
  <h1>ç²¾é¦å¡”è®¾è®¡çš„å½±å“å› ç´ è§£æ</h1>
  <!-- ä½¿ç”¨è¯´æ˜æ¨¡æ€æ¡† -->
  <div id="helpModal" style="
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    z-index: 1000;
    justify-content: center;
    align-items: center;
  ">
    <div style="
      background: white;
      width: 90%;
      max-width: 700px;
      max-height: 85vh;
      overflow-y: auto;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.4);
      font-family: 'Segoe UI', sans-serif;
      line-height: 1.6;
    ">
      <h2 style="margin-top:0; color:#2c3e50;">ğŸ“˜ ä½¿ç”¨è¯´æ˜</h2>

      <h3>ğŸ¯ ç›®çš„</h3>
      <p>
        æœ¬è½¯ä»¶ç”¨äºè¾…åŠ©ã€Šè¿‡ç¨‹å·¥ç¨‹åŸç†ã€‹ã€ã€ŠåŒ–å·¥åŸç†ã€‹æˆ–ã€Šåˆ†ç¦»å·¥ç¨‹ã€‹è¯¾ç¨‹ä¸­<strong>äºŒå…ƒè¿ç»­ç²¾é¦å¡”</strong>çš„è®¾è®¡ä¸åˆ†æï¼Œå¸®åŠ©å­¦ç”Ÿç›´è§‚ç†è§£ï¼š</p>
      </p>
      <ul>
        <li>McCabe-Thiele å›¾è§£æ³•çš„é€æ¿è®¡ç®—è¿‡ç¨‹</li>
        <li>å›æµæ¯”ã€è¿›æ–™çƒ­çŠ¶æ€ã€ç›¸å¯¹æŒ¥å‘åº¦å¯¹ç†è®ºæ¿æ•°çš„å½±å“</li>
        <li>æœ€ä¼˜è¿›æ–™ä½ç½®çš„é€‰æ‹©åŠå…¶å¯¹èƒ½è€—ï¼ˆå›æµæ¯”ï¼‰çš„å½±å“</li>
      </ul>

      <h3>ğŸ”¬ æ”¯æŒçš„ç ”ç©¶å†…å®¹</h3>
      <ul>
        <li><strong>Î±ï¼ˆç›¸å¯¹æŒ¥å‘åº¦ï¼‰å¯è°ƒ</strong>ï¼šæ¨¡æ‹Ÿä¸åŒç‰©ç³»ï¼ˆå¦‚è‹¯-ç”²è‹¯ Î±â‰ˆ2.5ï¼Œä¹™é†‡-æ°´ Î±â‰ˆ2.2ï¼‰</li>
        <li><strong>ä»»æ„ q å€¼è¿›æ–™</strong>ï¼šå†·æ¶²ï¼ˆq>1ï¼‰ã€é¥±å’Œæ¶²ï¼ˆq=1ï¼‰ã€æ°”æ¶²æ··åˆï¼ˆ0&lt;q&lt;1ï¼‰ã€é¥±å’Œè’¸æ±½ï¼ˆq=0ï¼‰</li>
        <li><strong>è¿›æ–™ä½ç½®æ•æ„Ÿæ€§åˆ†æ</strong>ï¼šè‡ªåŠ¨è®¡ç®—ä¸åŒè¿›æ–™æ¿æ‰€éœ€æœ€å°å›æµæ¯”ï¼Œæ‰¾å‡ºæœ€ä¼˜ä½ç½®</li>
        <li><strong>æ•°æ®å¯¼å‡º</strong>ï¼šä¸€é”®å¯¼å‡ºå„å¡”æ¿æ¶²ç›¸/æ°”ç›¸ç»„æˆï¼ˆCSVæ ¼å¼ï¼‰ï¼Œä¾¿äºç»˜å›¾æˆ–æŠ¥å‘Šæ’°å†™</li>
        <li><strong>çŸ¥è¯†æµ‹éªŒ</strong>ï¼šéšæœºæŠ½å–ç²¾é¦å¡”ç›¸å…³é€‰æ‹©é¢˜ï¼Œæ£€éªŒå­¦ä¹ æ•ˆæœ</li>
      </ul>

      <h3>ğŸ–±ï¸ ä½¿ç”¨æ­¥éª¤</h3>
      <ol>
        <li><strong>è°ƒæ•´å‚æ•°</strong>ï¼šé€šè¿‡æ»‘å—è®¾ç½® Î±ã€z<sub>F</sub>ã€x<sub>D</sub>ã€Rã€q å’Œè¿›æ–™æ¿ä½ç½®ï¼ˆè®¾ä¸º 0 è¡¨ç¤ºè‡ªåŠ¨ä¼˜åŒ–ï¼‰</li>
        <li><strong>æŸ¥çœ‹ç»“æœ</strong>ï¼šä¸­é—´åŒºåŸŸè‡ªåŠ¨ç”Ÿæˆ McCabe-Thiele å›¾ã€å¡”ç»“æ„å›¾ã€ç†è®ºæ¿æ•°åŠ x<sub>W</sub></li>
        <li><strong>é€æ¿æ¼”ç¤º</strong>ï¼šç‚¹å‡» â€œâ–¶ é€æ¿æ¼”ç¤ºâ€ åŠ¨æ€è§‚å¯Ÿé˜¶æ¢¯ä½œå›¾è¿‡ç¨‹ï¼Œå¯¹åº”å¡”æ¿é«˜äº®æ˜¾ç¤º</li>
        <li><strong>åˆ†æè¿›æ–™å½±å“</strong>ï¼šç‚¹å‡» â€œğŸ”¬ åˆ†æè¿›æ–™ä½ç½®å½±å“â€ï¼Œç¨‹åºè‡ªåŠ¨æ‰«ææ‰€æœ‰å¯èƒ½è¿›æ–™æ¿ï¼Œç»™å‡ºæœ€ä¼˜é€‰æ‹©</li>
        <li><strong>å¯¼å‡ºæ•°æ®</strong>ï¼šç‚¹å‡» â€œğŸ“¥ å¯¼å‡º CSVâ€ è·å–å¡”æ¿ç»„æˆæ•°æ®ï¼Œç”¨äº Excel æˆ– Python è¿›ä¸€æ­¥å¤„ç†</li>
        <li><strong>çŸ¥è¯†æµ‹éªŒ</strong>ï¼šç‚¹å‡» â€œğŸ“ çŸ¥è¯†æµ‹éªŒâ€ éšæœºæŠ½å–5é“é€‰æ‹©é¢˜ï¼Œæ£€éªŒå¯¹ç²¾é¦å¡”çŸ¥è¯†çš„æŒæ¡ç¨‹åº¦</li>
      </ol>

      <h3>ğŸ’¡ å°è´´å£«</h3>
      <ul>
        <li>ç¡®ä¿ <code>x<sub>D</sub> &gt; z<sub>F</sub> &gt; x<sub>W</sub></code>ï¼Œå¦åˆ™æ— æ³•åˆ†ç¦»</li>
        <li>å›æµæ¯” R å¿…é¡»å¤§äºæœ€å°å›æµæ¯” R<sub>min</sub>ï¼Œå¦åˆ™æ— æ³•æ”¶æ•›</li>
        <li>Î± è¶Šå°ï¼ˆæ¥è¿‘ 1ï¼‰ï¼Œåˆ†ç¦»è¶Šéš¾ï¼Œæ‰€éœ€ç†è®ºæ¿æ•°è¶Šå¤š</li>
        <li>è¿›æ–™æ¿åº”å°½é‡é è¿‘å¡”å†…ä¸¤æ“ä½œçº¿äº¤ç‚¹å¯¹åº”çš„æµ“åº¦ä½ç½®</li>
      </ul>

      <button onclick="closeHelpModal()" style="
        margin-top: 20px;
        padding: 8px 20px;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 15px;
      ">å…³é—­</button>
    </div>
  </div>

  <!-- æµ‹éªŒæ¨¡æ€æ¡† -->
  <div id="quizModal">
    <div id="quizContent">
      <div class="quiz-header">
        <h2>ğŸ“ ç²¾é¦å¡”çŸ¥è¯†æµ‹éªŒ</h2>
        <button class="quiz-close" onclick="closeQuizModal()">&times;</button>
      </div>
      
      <div id="quizQuestions">
        <!-- é¢˜ç›®å°†åŠ¨æ€ç”Ÿæˆ -->
      </div>
      
      <div class="quiz-footer">
        <button class="quiz-btn quiz-btn-large" onclick="submitQuiz()">æäº¤ç­”æ¡ˆ</button>
        <button class="quiz-btn quiz-btn-large" onclick="resetQuiz()">é‡æ–°ç­”é¢˜</button>
      </div>
      
      <div id="quizResult" class="quiz-result">
        <h3 id="resultTitle"></h3>
        <div id="resultDetails" style="margin-top: 15px;">
          <!-- ç­”é¢˜è¯¦æƒ…å°†åŠ¨æ€ç”Ÿæˆ -->
        </div>
        <button class="quiz-btn quiz-btn-large" style="margin-top: 20px;" onclick="startNewQuiz()">å†æ¥ä¸€å¥—</button>
      </div>
    </div>
  </div>

  <!-- ä¸»è¡¨æ ¼å¸ƒå±€ -->
  <table class="main-table">
    <!-- ç¬¬ä¸€è¡Œï¼šå¡”ç»“æ„ + McCabeå›¾ + å‚æ•°é¢æ¿ -->
    <tr>
      <!-- å·¦ä¾§ï¼šç²¾é¦å¡”ç»“æ„ -->
      <td class="tower-col">
        <div class="panel">
          <h3 class="panel-title">ç²¾é¦å¡”ç»“æ„ï¼ˆ#1 = å¡”é¡¶ç¬¬ä¸€å—æ¿ï¼‰</h3>
          <svg class="tower-svg" id="towerSvg" viewBox="0 0 150 550"></svg>
          <div style="margin-top:0px; font-size:14px; color:#555; text-align:center;">
            å½“å‰æ¿ï¼š<span id="currentStage" style="color:#e74c3c; font-weight:bold;">â€”</span>
          </div>
        </div>
      </td>

      <!-- ä¸­é—´ï¼šMcCabe-Thieleå›¾è§£ -->
      <td class="mt-col">
        <div class="panel">
          <h3 class="panel-title">McCabe-Thiele å›¾è§£</h3>
          <svg id="mtPlot" viewBox="0 0 650 580"></svg> <!-- å¢åŠ viewBoxé«˜åº¦ï¼Œç»™æ ‡ç­¾ç•™å‡ºç©ºé—´ -->
        </div>
      </td>

      <!-- å³ä¾§ï¼šå‚æ•°è®¾ç½®é¢æ¿ -->
      <td class="param-col">
        <div class="panel">
          <h3 class="panel-title">å‚æ•°è®¾ç½®</h3>
          
          <label for="alpha">ç›¸å¯¹æŒ¥å‘åº¦ Î±ï¼š<span id="alphaValue" class="param-value">2.50</span></label>
          <input type="range" id="alpha" min="1.1" max="10" step="0.1" value="2.5">

          <label for="zF">è¿›æ–™ç»„æˆ z<sub>F</sub>ï¼ˆè½»ç»„åˆ†ï¼‰ï¼š<span id="zFValue" class="param-value">0.50</span></label>
          <input type="range" id="zF" min="0.1" max="0.9" step="0.01" value="0.5">

          <label for="xD">å¡”é¡¶äº§å“ x<sub>D</sub>ï¼ˆè½»ç»„åˆ†ï¼‰ï¼š<span id="xDValue" class="param-value">0.95</span></label>
          <input type="range" id="xD" min="0.7" max="0.99" step="0.01" value="0.95">

          <label for="R">å›æµæ¯” Rï¼š<span id="RValue" class="param-value">2.0</span></label>
          <input type="range" id="R" min="0.5" max="5" step="0.1" value="2.0">

          <label for="q">è¿›æ–™çƒ­çŠ¶æ€ qï¼š<span id="qValue" class="param-value">1.0</span></label>
          <input type="range" id="q" min="0" max="2" step="0.1" value="1.0">
          <div class="param-note">
            q=1: é¥±å’Œæ¶²ä½“ | q>1: å†·æ¶² | 0<q<1: æ°”æ¶²æ··åˆ | q=0: é¥±å’Œè’¸æ±½
          </div>

          <label for="feedStage">è¿›æ–™æ¿ä½ç½®ï¼ˆ#ï¼‰ï¼š<span id="feedStageValue" class="param-value">è‡ªåŠ¨</span></label>
          <input type="range" id="feedStage" min="0" max="50" step="1" value="0">
          <div class="param-note">
            0 = è‡ªåŠ¨ï¼ˆæœ€ä¼˜ï¼‰ï¼›1 = å¡”é¡¶ç¬¬ä¸€å—ç†è®ºæ¿
          </div>

          <div class="result-box" id="results">
            ç­‰å¾…è®¡ç®—...
          </div>

          <div class="equation-box" id="equations">
            æ–¹ç¨‹å°†åœ¨æ­¤æ˜¾ç¤º
          </div>
        </div>
      </td>
    </tr>

    <!-- ç¬¬äºŒè¡Œï¼šæ“æ§ç•Œé¢ï¼ˆæ¨ªå‘å¸ƒå±€ï¼‰ -->
    <tr class="control-row">
      <td colspan="3">
        <div class="panel control-panel">
          <button onclick="openHelpModal()" class="help-btn">ğŸ“˜ ä½¿ç”¨è¯´æ˜</button>
          <button onclick="runFullSimulation()">ğŸ”„ é‡æ–°è®¡ç®—</button>
          <button onclick="startStepByStep()" id="stepBtn">â–¶ é€æ¿æ¼”ç¤º</button>
          <button onclick="resetDemo()" id="resetBtn">â†º é‡ç½®</button>
          <button onclick="exportDataToCSV()" class="export-btn">ğŸ“¥ å¯¼å‡º CSV</button>
          <button onclick="runFeedStageStudy()" class="study-btn">ğŸ”¬ åˆ†æè¿›æ–™ä½ç½®å½±å“</button>
          <button onclick="openQuizModal()" class="quiz-btn">ğŸ“ çŸ¥è¯†æµ‹éªŒ</button>
        </div>
      </td>
    </tr>

    <!-- ç¬¬ä¸‰è¡Œï¼šæ•°æ®å±•ç¤ºåŒº -->
    <tr class="data-row">
      <td colspan="3">
        <div class="panel data-panel">
          <h3 class="panel-title">æ•°æ®å±•ç¤ºåŒº</h3>
          <div style="display: flex; gap: 20px; flex-wrap: wrap;">
            <!-- å¡”æ¿ç»„æˆæ•°æ®è¡¨ -->
            <div style="flex: 1; min-width: 300px;">
              <h4 style="color:#34495e; margin-bottom:8px;">å¡”æ¿ç»„æˆæ•°æ®è¡¨</h4>
              <div style="max-height: 250px; overflow-y: auto; border: 1px solid #eee; border-radius: 4px;">
                <table class="data-table">
                  <thead><tr><th>æ¿å·</th><th>x<sub>n</sub>ï¼ˆæ¶²ç›¸ï¼‰</th><th>y<sub>n</sub>ï¼ˆæ°”ç›¸ï¼‰</th></tr></thead>
                  <tbody id="dataBody"></tbody>
                </table>
              </div>
            </div>

            <!-- è¿›æ–™ä½ç½®ç ”ç©¶ç»“æœ - å®½åº¦åŠ å€ -->
            <div style="flex: 2; min-width: 600px;"> <!-- flexä»1æ”¹ä¸º2ï¼Œå®½åº¦åŠ å€ -->
              <h4 style="color:#34495e; margin-bottom:8px;">è¿›æ–™ä½ç½®å½±å“åˆ†æç»“æœ</h4>
              <div id="feedStudyPlot" style="min-height: 230px; display: flex; flex-direction: column; align-items: center; justify-content: center; color:#666; width: 100%;">
                <p>ç‚¹å‡»ä¸Šæ–¹"åˆ†æè¿›æ–™ä½ç½®å½±å“"æŒ‰é’®æŸ¥çœ‹ç»“æœ</p>
              </div>
            </div>
          </div>
        </div>
      </td>
    </tr>
  </table>

  <script>
    // === å…¨å±€å˜é‡ ===
    let currentAlpha = 2.5;
    let currentSteps = [];
    let currentStepIndex = -1;
    let animationInterval = null;
    let global_xD, global_xW, global_R, global_zF, global_q;
    let plateData = [];
    let quizQuestions = []; // å­˜å‚¨å½“å‰æµ‹éªŒçš„é¢˜ç›®
    let allQuizQuestions = []; // å­˜å‚¨æ‰€æœ‰30é“é¢˜ç›®

    // === 30é“ç²¾é¦å¡”ç›¸å…³é€‰æ‹©é¢˜ ===
    function initQuizQuestions() {
      allQuizQuestions = [
        {
          id: 1,
          question: "åœ¨McCabe-Thieleå›¾è§£æ³•ä¸­ï¼Œå¯¹è§’çº¿çš„æ„ä¹‰æ˜¯ï¼Ÿ",
          options: [
            "æ°”æ¶²å¹³è¡¡çº¿",
            "y = xï¼Œç”¨äºè¡¨ç¤ºæ°”æ¶²ç»„æˆç›¸ç­‰çš„æƒ…å†µ",
            "ç²¾é¦æ®µæ“ä½œçº¿",
            "æé¦æ®µæ“ä½œçº¿"
          ],
          answer: 1,
          explanation: "å¯¹è§’çº¿y=xæ˜¯McCabe-Thieleå›¾è§£æ³•çš„åŸºå‡†çº¿ï¼Œä»£è¡¨æ°”æ¶²ä¸¤ç›¸ç»„æˆç›¸ç­‰çš„ç†æƒ³æƒ…å†µï¼Œå®é™…åˆ†ç¦»è¿‡ç¨‹ä¸­éœ€è¦åç¦»è¿™æ¡çº¿æ‰èƒ½å®ç°åˆ†ç¦»ã€‚"
        },
        {
          id: 2,
          question: "ç›¸å¯¹æŒ¥å‘åº¦Î±çš„å€¼è¶Šæ¥è¿‘1ï¼Œè¯´æ˜ä»€ä¹ˆï¼Ÿ",
          options: [
            "ä¸¤ç»„åˆ†è¶Šå®¹æ˜“åˆ†ç¦»",
            "ä¸¤ç»„åˆ†è¶Šéš¾åˆ†ç¦»",
            "åˆ†ç¦»æ‰€éœ€ç†è®ºæ¿æ•°è¶Šå°‘",
            "å›æµæ¯”å¯ä»¥è¶Šå°"
          ],
          answer: 1,
          explanation: "ç›¸å¯¹æŒ¥å‘åº¦Î±æ˜¯è¡¡é‡ä¸¤ç»„åˆ†åˆ†ç¦»éš¾æ˜“ç¨‹åº¦çš„é‡è¦å‚æ•°ã€‚Î±=1æ—¶ä¸¤ç»„åˆ†æ— æ³•ç”¨ç²¾é¦åˆ†ç¦»ï¼ŒÎ±è¶Šæ¥è¿‘1ï¼Œåˆ†ç¦»éš¾åº¦è¶Šå¤§ï¼Œæ‰€éœ€ç†è®ºæ¿æ•°è¶Šå¤šã€‚"
        },
        {
          id: 3,
          question: "å½“è¿›æ–™çƒ­çŠ¶æ€q=1æ—¶ï¼Œè¿›æ–™å±äºå“ªç§ç±»å‹ï¼Ÿ",
          options: [
            "å†·æ¶²è¿›æ–™",
            "é¥±å’Œæ¶²ä½“è¿›æ–™",
            "æ°”æ¶²æ··åˆè¿›æ–™",
            "é¥±å’Œè’¸æ±½è¿›æ–™"
          ],
          answer: 1,
          explanation: "qå€¼è¡¨ç¤ºè¿›æ–™ä¸­æ¶²ç›¸æ‰€å çš„åˆ†æ•°ï¼šq>1ä¸ºå†·æ¶²è¿›æ–™ï¼Œq=1ä¸ºé¥±å’Œæ¶²ä½“è¿›æ–™ï¼Œ0<q<1ä¸ºæ°”æ¶²æ··åˆè¿›æ–™ï¼Œq=0ä¸ºé¥±å’Œè’¸æ±½è¿›æ–™ã€‚"
        },
        {
          id: 4,
          question: "æœ€å°å›æµæ¯”Rminçš„ç‰©ç†æ„ä¹‰æ˜¯ï¼Ÿ",
          options: [
            "å®ç°æŒ‡å®šåˆ†ç¦»è¦æ±‚æ‰€éœ€çš„æœ€å¤§å›æµæ¯”",
            "å®ç°æŒ‡å®šåˆ†ç¦»è¦æ±‚æ‰€éœ€çš„æœ€å°å›æµæ¯”ï¼Œæ­¤æ—¶ç†è®ºæ¿æ•°æ— ç©·å¤š",
            "å›æµæ¯”çš„æœ€ä½³å€¼",
            "å›æµæ¯”çš„æœ€å°å€¼ï¼Œæ­¤æ—¶ç†è®ºæ¿æ•°æœ€å°‘"
          ],
          answer: 1,
          explanation: "æœ€å°å›æµæ¯”Rminæ˜¯å®ç°æŒ‡å®šåˆ†ç¦»è¦æ±‚ï¼ˆxDã€xWï¼‰æ‰€éœ€çš„æœ€å°å›æµæ¯”ï¼Œæ­¤æ—¶æ“ä½œçº¿ä¸qçº¿çš„äº¤ç‚¹åˆšå¥½è½åœ¨å¹³è¡¡çº¿ä¸Šï¼Œæ‰€éœ€ç†è®ºæ¿æ•°ä¸ºæ— ç©·å¤šã€‚å®é™…å›æµæ¯”å¿…é¡»å¤§äºRminã€‚"
        },
        {
          id: 5,
          question: "ç²¾é¦å¡”ä¸­ï¼Œç²¾é¦æ®µçš„ä½œç”¨æ˜¯ï¼Ÿ",
          options: [
            "æµ“ç¼©è½»ç»„åˆ†ï¼Œæé«˜å¡”é¡¶äº§å“çº¯åº¦",
            "æµ“ç¼©é‡ç»„åˆ†ï¼Œæé«˜å¡”é‡œäº§å“çº¯åº¦",
            "æä¾›ç²¾é¦æ‰€éœ€çš„è’¸æ±½",
            "æä¾›ç²¾é¦æ‰€éœ€çš„æ¶²ä½“"
          ],
          answer: 0,
          explanation: "ç²¾é¦æ®µä½äºè¿›æ–™æ¿ä¸Šæ–¹ï¼Œé€šè¿‡å›æµæ¶²ä¸ä¸Šå‡è’¸æ±½çš„æ¥è§¦ï¼Œå°†è’¸æ±½ä¸­çš„é‡ç»„åˆ†å†·å‡ä¸‹æ¥ï¼ŒåŒæ—¶å°†æ¶²ä½“ä¸­çš„è½»ç»„åˆ†æ±½åŒ–ï¼Œä»è€Œæé«˜å¡”é¡¶äº§å“ä¸­è½»ç»„åˆ†çš„çº¯åº¦ã€‚"
        },
        {
          id: 6,
          question: "æé¦æ®µæ“ä½œçº¿çš„æ–œç‡é€šå¸¸ï¼Ÿ",
          options: [
            "å¤§äº1",
            "ç­‰äº1",
            "å°äº1",
            "ä¸ç¡®å®š"
          ],
          answer: 0,
          explanation: "æé¦æ®µæ“ä½œçº¿çš„æ–œç‡ä¸ºL'/V'ï¼ˆæé¦æ®µæ¶²ä½“æµé‡ä¸è’¸æ±½æµé‡ä¹‹æ¯”ï¼‰ï¼Œç”±äºL' = L + qFï¼ŒV' = V - (1-q)Fï¼Œé€šå¸¸L'/V' > 1ï¼Œå› æ­¤æé¦æ®µæ“ä½œçº¿æ–œç‡å¤§äº1ã€‚"
        },
        {
          id: 7,
          question: "å½“å›æµæ¯”Rå¢å¤§æ—¶ï¼Œæ‰€éœ€ç†è®ºæ¿æ•°ä¼šï¼Ÿ",
          options: [
            "å¢åŠ ",
            "å‡å°‘",
            "ä¸å˜",
            "å…ˆå¢åŠ åå‡å°‘"
          ],
          answer: 1,
          explanation: "å›æµæ¯”Rå¢å¤§ï¼Œç²¾é¦æ®µæ“ä½œçº¿æ–œç‡R/(R+1)å¢å¤§ï¼Œæ“ä½œçº¿æ›´é è¿‘å¯¹è§’çº¿ï¼Œæ‰€éœ€ç†è®ºæ¿æ•°å‡å°‘ï¼Œä½†èƒ½è€—ä¼šå¢åŠ ã€‚å­˜åœ¨æœ€ä¼˜å›æµæ¯”ä½¿æ€»è´¹ç”¨æœ€ä½ã€‚"
        },
        {
          id: 8,
          question: "åœ¨ç²¾é¦å¡”è®¾è®¡ä¸­ï¼Œè¿›æ–™æ¿ä½ç½®çš„é€‰æ‹©åº”ä½¿ï¼Ÿ",
          options: [
            "å°½é‡é è¿‘å¡”é¡¶",
            "å°½é‡é è¿‘å¡”é‡œ",
            "é è¿‘ä¸¤æ“ä½œçº¿äº¤ç‚¹å¯¹åº”çš„ç†è®ºæ¿ä½ç½®",
            "ä»»æ„ä½ç½®å‡å¯"
          ],
          answer: 2,
          explanation: "æœ€ä¼˜è¿›æ–™æ¿ä½ç½®åº”ä½¿è¿›æ–™ç»„æˆä¸å¡”å†…è¯¥ä½ç½®çš„æ¶²ç›¸ç»„æˆç›¸è¿‘ï¼Œå³é è¿‘ä¸¤æ“ä½œçº¿äº¤ç‚¹å¯¹åº”çš„ç†è®ºæ¿ä½ç½®ï¼Œè¿™æ ·å¯ä»¥ä½¿åˆ†ç¦»æ•ˆç‡æœ€é«˜ï¼Œèƒ½è€—æœ€ä½ã€‚"
        },
        {
          id: 9,
          question: "ç²¾é¦å¡”çš„æ“ä½œçº¿æ–¹ç¨‹è¡¨ç¤ºçš„æ˜¯ï¼Ÿ",
          options: [
            "æ°”æ¶²å¹³è¡¡å…³ç³»",
            "ç›¸é‚»å¡”æ¿é—´æ°”æ¶²ç»„æˆçš„å…³ç³»",
            "è¿›æ–™ç»„æˆä¸äº§å“ç»„æˆçš„å…³ç³»",
            "å›æµæ¯”ä¸ç†è®ºæ¿æ•°çš„å…³ç³»"
          ],
          answer: 1,
          explanation: "æ“ä½œçº¿æ–¹ç¨‹æè¿°äº†ç²¾é¦å¡”å†…ç›¸é‚»å¡”æ¿é—´ä¸Šå‡è’¸æ±½ç»„æˆä¸ä¸‹é™æ¶²ä½“ç»„æˆä¹‹é—´çš„ç‰©æ–™è¡¡ç®—å…³ç³»ï¼Œåˆ†ä¸ºç²¾é¦æ®µæ“ä½œçº¿å’Œæé¦æ®µæ“ä½œçº¿ã€‚"
        },
        {
          id: 10,
          question: "å¯¹äºäºŒå…ƒç²¾é¦ï¼Œè‹¥xDå¢å¤§ï¼ˆè¦æ±‚å¡”é¡¶äº§å“çº¯åº¦æ›´é«˜ï¼‰ï¼Œåˆ™æ‰€éœ€ç†è®ºæ¿æ•°ä¼šï¼Ÿ",
          options: [
            "å¢åŠ ",
            "å‡å°‘",
            "ä¸å˜",
            "æ— æ³•ç¡®å®š"
          ],
          answer: 0,
          explanation: "åœ¨å…¶ä»–æ¡ä»¶ä¸å˜çš„æƒ…å†µä¸‹ï¼Œè¦æ±‚å¡”é¡¶äº§å“çº¯åº¦è¶Šé«˜ï¼ˆxDè¶Šå¤§ï¼‰ï¼Œåˆ†ç¦»éš¾åº¦è¶Šå¤§ï¼Œæ‰€éœ€ç†è®ºæ¿æ•°è¶Šå¤šï¼ŒåŒæ—¶æœ€å°å›æµæ¯”Rminä¹Ÿä¼šå¢å¤§ã€‚"
        },
        {
          id: 11,
          question: "å†·å‡å™¨çš„ä½œç”¨æ˜¯ï¼Ÿ",
          options: [
            "æä¾›ç²¾é¦æ‰€éœ€çš„çƒ­é‡",
            "å°†å¡”é¡¶ä¸Šå‡è’¸æ±½å†·å‡ä¸ºæ¶²ä½“ï¼Œæä¾›å›æµå’Œäº§å“",
            "åˆ†ç¦»æ°”æ¶²æ··åˆç‰©",
            "æµ“ç¼©é‡ç»„åˆ†"
          ],
          answer: 1,
          explanation: "å†·å‡å™¨ä½äºå¡”é¡¶ï¼Œå…¶ä½œç”¨æ˜¯å°†å¡”é¡¶ä¸Šå‡çš„å«è½»ç»„åˆ†è¾ƒå¤šçš„è’¸æ±½å†·å‡ä¸ºæ¶²ä½“ï¼Œä¸€éƒ¨åˆ†ä½œä¸ºå›æµæ¶²è¿”å›å¡”å†…ï¼Œå¦ä¸€éƒ¨åˆ†ä½œä¸ºå¡”é¡¶äº§å“é‡‡å‡ºã€‚"
        },
        {
          id: 12,
          question: "å†æ²¸å™¨çš„ä½œç”¨æ˜¯ï¼Ÿ",
          options: [
            "å†·å´å¡”é‡œæ¶²ä½“",
            "å°†å¡”é‡œæ¶²ä½“éƒ¨åˆ†æ±½åŒ–ï¼Œæä¾›ä¸Šå‡è’¸æ±½",
            "åˆ†ç¦»å¡”é¡¶è’¸æ±½",
            "æä¾›å›æµæ¶²"
          ],
          answer: 1,
          explanation: "å†æ²¸å™¨ä½äºå¡”é‡œï¼Œå…¶ä½œç”¨æ˜¯å°†å¡”é‡œæ¶²ä½“éƒ¨åˆ†æ±½åŒ–ï¼Œäº§ç”Ÿä¸Šå‡è’¸æ±½ï¼Œä¸ºç²¾é¦è¿‡ç¨‹æä¾›ä¼ è´¨æ¨åŠ¨åŠ›ï¼ŒåŒæ—¶å¡”é‡œå‰©ä½™æ¶²ä½“ä½œä¸ºå¡”åº•äº§å“é‡‡å‡ºã€‚"
        },
        {
          id: 13,
          question: "å½“è¿›æ–™ä¸ºå†·æ¶²è¿›æ–™ï¼ˆq>1ï¼‰æ—¶ï¼Œqçº¿çš„æ–œç‡ä¸ºï¼Ÿ",
          options: [
            "æ­£å€¼ä¸”å¤§äº1",
            "æ­£å€¼ä¸”å°äº1",
            "è´Ÿå€¼",
            "æ— ç©·å¤§"
          ],
          answer: 0,
          explanation: "qçº¿æ–¹ç¨‹ä¸ºy = [q/(q-1)]x - zF/(q-1)ã€‚å½“q>1æ—¶ï¼Œq/(q-1)ä¸ºæ­£å€¼ä¸”å¤§äº1ï¼Œå› æ­¤qçº¿ä¸ºæ–œç‡å¤§äº1çš„ç›´çº¿ã€‚"
        },
        {
          id: 14,
          question: "ç²¾é¦å¡”çš„å›æµæ¯”Ræ˜¯æŒ‡ï¼Ÿ",
          options: [
            "å¡”é¡¶å›æµé‡ä¸å¡”é¡¶äº§å“é‡ä¹‹æ¯”",
            "å¡”é¡¶äº§å“é‡ä¸å›æµé‡ä¹‹æ¯”",
            "å›æµé‡ä¸å¡”é‡œäº§å“é‡ä¹‹æ¯”",
            "å›æµé‡ä¸è¿›æ–™é‡ä¹‹æ¯”"
          ],
          answer: 0,
          explanation: "å›æµæ¯”Rçš„å®šä¹‰ä¸ºå¡”é¡¶å›æµé‡Lä¸å¡”é¡¶äº§å“é‡Dä¹‹æ¯”ï¼Œå³R = L/Dã€‚å›æµæ¯”æ˜¯ç²¾é¦æ“ä½œä¸­æœ€é‡è¦çš„æ“ä½œå‚æ•°ä¹‹ä¸€ã€‚"
        },
        {
          id: 15,
          question: "åœ¨McCabe-Thieleå›¾è§£æ³•ä¸­ï¼Œç†è®ºæ¿æ•°çš„ç¡®å®šæ˜¯é€šè¿‡ï¼Ÿ",
          options: [
            "è®¡ç®—æ³•ç›´æ¥å¾—åˆ°",
            "ç”»é˜¶æ¢¯çº¿ï¼ˆç›´è§’æ¢¯çº§ï¼‰",
            "æµ‹é‡æ“ä½œçº¿é•¿åº¦",
            "è®¡ç®—å¹³è¡¡çº¿ä¸æ“ä½œçº¿çš„äº¤ç‚¹æ•°"
          ],
          answer: 1,
          explanation: "McCabe-Thieleå›¾è§£æ³•çš„æ ¸å¿ƒæ˜¯åœ¨y-xå›¾ä¸Šï¼Œä»å¡”é¡¶xDå¼€å§‹ï¼Œäº¤æ›¿åœ¨å¹³è¡¡çº¿å’Œæ“ä½œçº¿ä¹‹é—´ç”»ç›´è§’æ¢¯çº§ï¼Œç›´åˆ°è¾¾åˆ°æˆ–ä½äºå¡”é‡œxWï¼Œæ¯ä¸ªæ¢¯çº§ä»£è¡¨ä¸€å—ç†è®ºæ¿ã€‚"
        },
        {
          id: 16,
          question: "è‹¥ç²¾é¦å¡”çš„å›æµæ¯”Rå°äºæœ€å°å›æµæ¯”Rminï¼Œåˆ™ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µï¼Ÿ",
          options: [
            "ç†è®ºæ¿æ•°å‡å°‘",
            "æ— æ³•è¾¾åˆ°æŒ‡å®šçš„åˆ†ç¦»è¦æ±‚",
            "èƒ½è€—é™ä½",
            "å¡”é¡¶äº§å“çº¯åº¦æé«˜"
          ],
          answer: 1,
          explanation: "å›æµæ¯”Rå¿…é¡»å¤§äºæœ€å°å›æµæ¯”Rminæ‰èƒ½å®ç°æŒ‡å®šçš„åˆ†ç¦»è¦æ±‚ã€‚å½“R < Rminæ—¶ï¼Œå³ä½¿æœ‰æ— ç©·å¤šå—ç†è®ºæ¿ï¼Œä¹Ÿæ— æ³•è¾¾åˆ°è¦æ±‚çš„xDå’ŒxWã€‚"
        },
        {
          id: 17,
          question: "ç²¾é¦è¿‡ç¨‹çš„ä¼ è´¨æ¨åŠ¨åŠ›æ˜¯ä»€ä¹ˆï¼Ÿ",
          options: [
            "æ¸©åº¦å·®",
            "å‹åŠ›å·®",
            "æµ“åº¦å·®ï¼ˆåç¦»æ°”æ¶²å¹³è¡¡ï¼‰",
            "å¯†åº¦å·®"
          ],
          answer: 2,
          explanation: "ç²¾é¦è¿‡ç¨‹çš„ä¼ è´¨æ¨åŠ¨åŠ›æ¥æºäºæ°”æ¶²ä¸¤ç›¸ç»„æˆåç¦»å¹³è¡¡çŠ¶æ€çš„æµ“åº¦å·®ã€‚å½“æ°”ç›¸ä¸­è½»ç»„åˆ†æµ“åº¦é«˜äºå¹³è¡¡æµ“åº¦ï¼Œæˆ–æ¶²ç›¸ä¸­è½»ç»„åˆ†æµ“åº¦ä½äºå¹³è¡¡æµ“åº¦æ—¶ï¼Œå°±ä¼šå‘ç”Ÿä¼ è´¨ã€‚"
        },
        {
          id: 18,
          question: "å¯¹äºé¥±å’Œè’¸æ±½è¿›æ–™ï¼ˆq=0ï¼‰ï¼Œä»¥ä¸‹è¯´æ³•æ­£ç¡®çš„æ˜¯ï¼Ÿ",
          options: [
            "è¿›æ–™ä¸­å…¨éƒ¨ä¸ºæ¶²ä½“",
            "è¿›æ–™ä¼šä½¿æé¦æ®µæ¶²ä½“æµé‡å¢åŠ ",
            "è¿›æ–™ä¸­å…¨éƒ¨ä¸ºè’¸æ±½",
            "qçº¿ä¸ºæ°´å¹³çº¿"
          ],
          answer: 2,
          explanation: "q=0è¡¨ç¤ºè¿›æ–™ä¸ºé¥±å’Œè’¸æ±½ï¼Œæ­¤æ—¶è¿›æ–™ä¸­å…¨éƒ¨ä¸ºè’¸æ±½ç›¸ã€‚qçº¿æ–¹ç¨‹ä¸ºy = zFï¼Œæ˜¯ä¸€æ¡æ°´å¹³çº¿ã€‚"
        },
        {
          id: 19,
          question: "ç²¾é¦å¡”çš„æ“ä½œå¼¹æ€§æ˜¯æŒ‡ï¼Ÿ",
          options: [
            "å¡”çš„è®¾è®¡èƒ½åŠ›ä¸å®é™…æ“ä½œèƒ½åŠ›ä¹‹æ¯”",
            "å¡”èƒ½å¤Ÿæ­£å¸¸æ“ä½œçš„è´Ÿè·èŒƒå›´",
            "å›æµæ¯”çš„è°ƒèŠ‚èŒƒå›´",
            "ç†è®ºæ¿æ•°çš„å˜åŒ–èŒƒå›´"
          ],
          answer: 1,
          explanation: "æ“ä½œå¼¹æ€§æ˜¯æŒ‡ç²¾é¦å¡”åœ¨ä¿è¯äº§å“è´¨é‡åˆæ ¼çš„å‰æä¸‹ï¼Œèƒ½å¤Ÿæ­£å¸¸æ“ä½œçš„æœ€å¤§è´Ÿè·ä¸æœ€å°è´Ÿè·ä¹‹æ¯”ï¼Œæ˜¯è¡¡é‡å¡”æ“ä½œç¨³å®šæ€§çš„é‡è¦æŒ‡æ ‡ã€‚"
        },
        {
          id: 20,
          question: "åœ¨ç²¾é¦å¡”ä¸­ï¼Œæ°”æ¶²ä¸¤ç›¸æ¥è§¦çš„æ–¹å¼ä¸»è¦æ˜¯ï¼Ÿ",
          options: [
            "é€†æµæ¥è§¦",
            "å¹¶æµæ¥è§¦",
            "é”™æµæ¥è§¦",
            "æŠ˜æµæ¥è§¦"
          ],
          answer: 0,
          explanation: "ç²¾é¦å¡”å†…æ°”æ¶²ä¸¤ç›¸é€šå¸¸é‡‡ç”¨é€†æµæ¥è§¦æ–¹å¼ï¼Œå³ä¸Šå‡è’¸æ±½ä¸ä¸‹é™æ¶²ä½“æ–¹å‘ç›¸åï¼Œè¿™ç§æ¥è§¦æ–¹å¼èƒ½å¤Ÿæä¾›æœ€å¤§çš„ä¼ è´¨æ¨åŠ¨åŠ›ï¼Œæé«˜åˆ†ç¦»æ•ˆç‡ã€‚"
        },
        {
          id: 21,
          question: "å½“è¿›æ–™ç»„æˆzFå¢åŠ æ—¶ï¼Œè‹¥å…¶ä»–æ¡ä»¶ä¸å˜ï¼Œå¡”é¡¶äº§å“xDå’Œå¡”é‡œäº§å“xWçš„å˜åŒ–è¶‹åŠ¿æ˜¯ï¼Ÿ",
          options: [
            "xDå¢å¤§ï¼ŒxWå¢å¤§",
            "xDå‡å°ï¼ŒxWå‡å°",
            "xDä¸å˜ï¼ŒxWå¢å¤§",
            "xDä¸å˜ï¼ŒxWå‡å°"
          ],
          answer: 3,
          explanation: "åœ¨å›æµæ¯”ã€ç†è®ºæ¿æ•°ç­‰æ¡ä»¶ä¸å˜çš„æƒ…å†µä¸‹ï¼Œè¿›æ–™ä¸­è½»ç»„åˆ†å«é‡zFå¢åŠ ï¼Œå¡”é¡¶äº§å“xDåŸºæœ¬ä¿æŒä¸å˜ï¼ˆç”±æ“ä½œçº¿å†³å®šï¼‰ï¼Œè€Œå¡”é‡œäº§å“xWä¼šå‡å°ï¼ˆè½»ç»„åˆ†å›æ”¶ç‡æé«˜ï¼‰ã€‚"
        },
        {
          id: 22,
          question: "ç†è®ºæ¿çš„å®šä¹‰æ˜¯ï¼Ÿ",
          options: [
            "å®é™…å·¥ä¸šå¡”ä¸­ä½¿ç”¨çš„å¡”æ¿",
            "æ°”æ¶²ä¸¤ç›¸åœ¨å¡”æ¿ä¸Šè¾¾åˆ°å®Œå…¨åˆ†ç¦»çš„ç†æƒ³å¡”æ¿",
            "æ°”æ¶²ä¸¤ç›¸åœ¨å¡”æ¿ä¸Šè¾¾åˆ°ç›¸å¹³è¡¡çš„ç†æƒ³å¡”æ¿",
            "æ•ˆç‡ä¸º100%çš„å®é™…å¡”æ¿"
          ],
          answer: 2,
          explanation: "ç†è®ºæ¿æ˜¯ä¸€ç§ç†æƒ³åŒ–çš„å¡”æ¿ï¼Œå‡è®¾æ°”æ¶²ä¸¤ç›¸åœ¨å¡”æ¿ä¸Šå……åˆ†æ¥è§¦å¹¶è¾¾åˆ°ç›¸å¹³è¡¡çŠ¶æ€ï¼Œç¦»å¼€ç†è®ºæ¿çš„æ°”æ¶²ä¸¤ç›¸ç»„æˆæ»¡è¶³ç›¸å¹³è¡¡å…³ç³»ã€‚"
        },
        {
          id: 23,
          question: "ç²¾é¦å¡”çš„æ¶²æ°”æ¯”L/Vå¢å¤§ï¼Œè¯´æ˜ï¼Ÿ",
          options: [
            "å›æµæ¯”å‡å°",
            "å›æµæ¯”å¢å¤§",
            "å¡”å†…æ¶²ä½“æµé‡å‡å°",
            "å¡”å†…è’¸æ±½æµé‡å¢å¤§"
          ],
          answer: 1,
          explanation: "æ¶²æ°”æ¯”L/Vä¸å›æµæ¯”Rå¯†åˆ‡ç›¸å…³ï¼Œç²¾é¦æ®µæ¶²æ°”æ¯”L/V = R/(R+1)ã€‚å½“Rå¢å¤§æ—¶ï¼ŒL/Vä¹Ÿå¢å¤§ï¼Œæ„å‘³ç€å¡”å†…æ¶²ä½“æµé‡ç›¸å¯¹è’¸æ±½æµé‡å¢åŠ ï¼Œä¼ è´¨æ•ˆç‡æé«˜ã€‚"
        },
        {
          id: 24,
          question: "åœ¨ç²¾é¦æ“ä½œä¸­ï¼Œè‹¥å‘ç°å¡”é¡¶äº§å“çº¯åº¦ä¸å¤Ÿï¼Œå¯èƒ½çš„åŸå› æ˜¯ï¼Ÿ",
          options: [
            "å›æµæ¯”å¤ªå¤§",
            "è¿›æ–™æ¿ä½ç½®å¤ªé«˜",
            "å›æµæ¯”å¤ªå°",
            "ç†è®ºæ¿æ•°å¤ªå¤š"
          ],
          answer: 2,
          explanation: "å›æµæ¯”å¤ªå°ä¼šå¯¼è‡´ç²¾é¦æ®µæ“ä½œçº¿æ–œç‡å¤ªå°ï¼Œåˆ†ç¦»èƒ½åŠ›ä¸è¶³ï¼Œæ— æ³•æœ‰æ•ˆæµ“ç¼©è½»ç»„åˆ†ï¼Œä»è€Œå¯¼è‡´å¡”é¡¶äº§å“çº¯åº¦ä¸å¤Ÿã€‚é€‚å½“å¢å¤§å›æµæ¯”å¯ä»¥æé«˜å¡”é¡¶äº§å“çº¯åº¦ã€‚"
        },
        {
          id: 25,
          question: "å¯¹äºäºŒå…ƒç²¾é¦ï¼Œä»¥ä¸‹å“ªä¸ªå…³ç³»å¼æ€»æ˜¯æˆç«‹ï¼Ÿ",
          options: [
            "xD > zF > xW",
            "xD < zF < xW",
            "xD = zF = xW",
            "xD > xW > zF"
          ],
          answer: 0,
          explanation: "ç²¾é¦çš„ç›®çš„æ˜¯åˆ†ç¦»æ··åˆç‰©ï¼Œä½¿è½»ç»„åˆ†åœ¨å¡”é¡¶å¯Œé›†ï¼Œé‡ç»„åˆ†åœ¨å¡”é‡œå¯Œé›†ã€‚å› æ­¤å¿…é¡»æ»¡è¶³xDï¼ˆå¡”é¡¶è½»ç»„åˆ†å«é‡ï¼‰> zFï¼ˆè¿›æ–™è½»ç»„åˆ†å«é‡ï¼‰> xWï¼ˆå¡”é‡œè½»ç»„åˆ†å«é‡ï¼‰ã€‚"
        },
        {
          id: 26,
          question: "å½“ç²¾é¦å¡”çš„æ“ä½œå‹åŠ›å‡é«˜æ—¶ï¼Œç›¸å¯¹æŒ¥å‘åº¦Î±é€šå¸¸ä¼šï¼Ÿ",
          options: [
            "å¢å¤§",
            "å‡å°",
            "ä¸å˜",
            "å…ˆå¢å¤§åå‡å°"
          ],
          answer: 1,
          explanation: "ç›¸å¯¹æŒ¥å‘åº¦Î±éšå‹åŠ›å‡é«˜è€Œå‡å°ã€‚å› ä¸ºå‹åŠ›å‡é«˜ä¼šä½¿å„ç»„åˆ†çš„æ²¸ç‚¹è¶‹è¿‘ï¼ŒæŒ¥å‘åº¦å·®å¼‚å‡å°ï¼Œå¯¼è‡´åˆ†ç¦»éš¾åº¦å¢å¤§ã€‚"
        },
        {
          id: 27,
          question: "ç²¾é¦æ®µæ“ä½œçº¿ä¸æé¦æ®µæ“ä½œçº¿çš„äº¤ç‚¹å–å†³äºï¼Ÿ",
          options: [
            "å›æµæ¯”å’Œè¿›æ–™ç»„æˆ",
            "è¿›æ–™çƒ­çŠ¶æ€å’Œè¿›æ–™ç»„æˆ",
            "å›æµæ¯”å’Œç†è®ºæ¿æ•°",
            "ç†è®ºæ¿æ•°å’Œè¿›æ–™ä½ç½®"
          ],
          answer: 1,
          explanation: "ä¸¤æ“ä½œçº¿çš„äº¤ç‚¹ç§°ä¸ºæŒŸç‚¹ï¼Œå…¶ä½ç½®ç”±è¿›æ–™çƒ­çŠ¶æ€qå’Œè¿›æ–™ç»„æˆzFå†³å®šï¼Œä¸å›æµæ¯”æ— å…³ã€‚qçº¿æ–¹ç¨‹æè¿°äº†è¿›æ–™çƒ­çŠ¶æ€å¯¹æ“ä½œçº¿çš„å½±å“ã€‚"
        },
        {
          id: 28,
          question: "åœ¨ç²¾é¦å¡”è®¾è®¡ä¸­ï¼Œé€šå¸¸é€‰æ‹©å›æµæ¯”Rä¸ºæœ€å°å›æµæ¯”Rminçš„å¤šå°‘å€ï¼Ÿ",
          options: [
            "0.5-0.8å€",
            "1.1-2.0å€",
            "2.0-3.0å€",
            "3.0-5.0å€"
          ],
          answer: 1,
          explanation: "å®é™…å›æµæ¯”é€šå¸¸é€‰æ‹©ä¸ºæœ€å°å›æµæ¯”çš„1.1-2.0å€ã€‚è¿™ä¸ªèŒƒå›´æ—¢èƒ½ä¿è¯åˆ†ç¦»è¦æ±‚ï¼Œåˆèƒ½é¿å…å›æµæ¯”è¿‡å¤§å¯¼è‡´çš„èƒ½è€—å¢åŠ å’Œè®¾å¤‡æŠ•èµ„å¢åŠ ã€‚"
        },
        {
          id: 29,
          question: "è‹¥ç²¾é¦å¡”çš„è¿›æ–™ä½ç½®è¿‡é«˜ï¼ˆé è¿‘å¡”é¡¶ï¼‰ï¼Œä¼šå¯¼è‡´ï¼Ÿ",
          options: [
            "ç²¾é¦æ®µæ¿æ•°ä¸è¶³ï¼Œå¡”é¡¶äº§å“çº¯åº¦ä¸‹é™",
            "æé¦æ®µæ¿æ•°ä¸è¶³ï¼Œå¡”é‡œäº§å“çº¯åº¦ä¸‹é™",
            "èƒ½è€—é™ä½",
            "åˆ†ç¦»æ•ˆç‡æé«˜"
          ],
          answer: 1,
          explanation: "è¿›æ–™ä½ç½®è¿‡é«˜æ„å‘³ç€æé¦æ®µå¡”æ¿æ•°å‡å°‘ï¼Œé‡ç»„åˆ†æ— æ³•å……åˆ†åˆ†ç¦»ï¼Œå¯¼è‡´å¡”é‡œäº§å“çº¯åº¦ä¸‹é™ã€‚æœ€ä¼˜è¿›æ–™ä½ç½®åº”ä½¿ç²¾é¦æ®µå’Œæé¦æ®µçš„æ¿æ•°åˆ†é…åˆç†ã€‚"
        },
        {
          id: 30,
          question: "McCabe-Thieleå›¾è§£æ³•çš„å‡è®¾æ¡ä»¶ä¸åŒ…æ‹¬ä»¥ä¸‹å“ªé¡¹ï¼Ÿ",
          options: [
            "æ’æ‘©å°”æµå‡è®¾",
            "ç†è®ºæ¿å‡è®¾",
            "ç†æƒ³æº¶æ¶²å‡è®¾",
            "æ’å‹æ“ä½œå‡è®¾"
          ],
          answer: 2,
          explanation: "McCabe-Thieleå›¾è§£æ³•çš„ä¸»è¦å‡è®¾åŒ…æ‹¬ï¼šæ’æ‘©å°”æµå‡è®¾ã€ç†è®ºæ¿å‡è®¾ã€æ’å‹æ“ä½œå‡è®¾ã€äºŒå…ƒæ··åˆç‰©ã€‚è¯¥æ–¹æ³•å¹¶ä¸è¦æ±‚æº¶æ¶²æ˜¯ç†æƒ³æº¶æ¶²ï¼Œåªéœ€çŸ¥é“æ°”æ¶²å¹³è¡¡å…³ç³»å³å¯ã€‚"
        }
      ];
    }

    // === ç‰©æ€§å‡½æ•°ï¼ˆä½¿ç”¨ currentAlphaï¼‰===
    function equilibrium(x) {
      return (currentAlpha * x) / (1 + (currentAlpha - 1) * x);
    }
    function solveForXFromY(y) {
      return y / (currentAlpha - (currentAlpha - 1) * y);
    }

    // === è®¡ç®— Rmin ===
    function calcRmin(xD, zF, q) {
      if (Math.abs(q - 1) < 1e-6) {
        const yq = equilibrium(zF);
        return Math.max(0, (xD - yq) / (yq - zF));
      } else {
        const a = q / (q - 1);
        const b = -zF / (q - 1);
        let x = zF;
        for (let i = 0; i < 30; i++) {
          const y_eq = equilibrium(x);
          const y_q = a * x + b;
          const f = y_eq - y_q;
          const dy_dx_eq = currentAlpha / Math.pow(1 + (currentAlpha - 1) * x, 2);
          const df_dx = dy_dx_eq - a;
          if (Math.abs(df_dx) < 1e-6) break;
          x -= f / df_dx;
          x = Math.min(0.999, Math.max(0.001, x));
        }
        const x_int = x;
        const y_int = a * x_int + b;
        const RminRaw = (xD - y_int) / (y_int - x_int);
        return Math.max(0, RminRaw);
      }
    }

    // === é€æ¿è®¡ç®— ===
    function steppingDetailed(xD, xW, R, zF, q) {
      const steps = [];
      plateData = [];
      let x = xD;
      let y = xD;
      let stage = 0;
      const MAX_STAGES = 100;

      const F = 1;
      const D = (zF - xW) / (xD - xW);
      const W = 1 - D;
      const L_bar = R * D + q * F;
      const V_bar = (R + 1) * D - (1 - q) * F;

      let xq, yq;
      if (Math.abs(q - 1) < 1e-6) {
        xq = zF;
        yq = (R / (R + 1)) * xq + xD / (R + 1);
      } else {
        const a_q = q / (q - 1);
        const b_q = -zF / (q - 1);
        const a_rect = R / (R + 1);
        const b_rect = xD / (R + 1);
        xq = (b_rect - b_q) / (a_q - a_rect);
        yq = a_rect * xq + b_rect;
      }

      plateData.push({stage: 0, x: xD, y: xD});

      while (x > xW) {
        if (stage >= MAX_STAGES) break;

        const x_eq = solveForXFromY(y);
        if (x_eq <= xW) {
          steps.push({ type: 'horizontal', from: {x, y}, to: {x: xW, y} });
          plateData.push({stage: stage + 1, x: xW, y: y});
          break;
        }
        steps.push({ type: 'horizontal', from: {x, y}, to: {x: x_eq, y} });
        x = x_eq;
        stage++;
        plateData.push({stage, x, y});

        let newY;
        if (x >= xq) {
          newY = (R / (R + 1)) * x + xD / (R + 1);
        } else {
          newY = (L_bar / V_bar) * x - (W * xW) / V_bar;
        }
        steps.push({ type: 'vertical', from: {x, y}, to: {x, y: newY}, stage });
        y = newY;
        if (y > 1 || y < 0) break;
      }

      return { steps, N: stage };
    }

    // === æ™ºèƒ½ä¼°ç®— xW ===
    function estimateXW(xD, zF, R, q) {
      const Rmin = calcRmin(xD, zF, q);
      if (Rmin <= 0) return 0.02;

      let xW = 0.02;
      for (let i = 0; i < 20; i++) {
        const { N } = steppingDetailed(xD, xW, R, zF, q);
        if (N > 25) {
          xW += 0.003;
        } else if (N < 4) {
          xW -= 0.003;
        } else {
          break;
        }
        xW = Math.min(0.12, Math.max(0.005, xW));
      }
      return xW;
    }

    // === å›ºå®šè¿›æ–™æ¿æ¨¡æ‹Ÿ ===
    function simulateWithFixedFeed(xD, zF, R, q, totalStages, feedStage, target_xW = 0.05) {
      let x = xD;
      let y = xD;

      const D = (zF - target_xW) / (xD - target_xW);
      const W = 1 - D;
      const L = R * D;
      const V = L + D;
      const L_bar = L + q * 1;
      const V_bar = V - (1 - q) * 1;

      for (let stage = 1; stage <= totalStages; stage++) {
        x = solveForXFromY(y);
        if (stage === totalStages) break;

        if (stage < feedStage) {
          y = (R / (R + 1)) * x + xD / (R + 1);
        } else {
          y = (L_bar / V_bar) * x - (W * target_xW) / V_bar;
        }

        if (isNaN(y) || y > 1.1 || y < -0.1 || x < 0) {
          return { success: false, xW: x };
        }
      }

      return { success: true, xW: x };
    }

    // === æœç´¢æœ€å° R ===
    function findMinRForFeedStage(xD, zF, q, totalStages, feedStage, target_xW = 0.05) {
      const Rmin_est = calcRmin(xD, zF, q);
      if (Rmin_est <= 0) return { feasible: false, R: Infinity };

      let R_low = Rmin_est * 1.01;
      let R_high = Rmin_est * 4;

      let highOk = simulateWithFixedFeed(xD, zF, R_high, q, totalStages, feedStage, target_xW).xW <= target_xW;
      if (!highOk) {
        R_high = Rmin_est * 10;
        highOk = simulateWithFixedFeed(xD, zF, R_high, q, totalStages, feedStage, target_xW).xW <= target_xW;
        if (!highOk) return { feasible: false, R: Infinity };
      }

      for (let iter = 0; iter < 25; iter++) {
        const R_mid = (R_low + R_high) / 2;
        const res = simulateWithFixedFeed(xD, zF, R_mid, q, totalStages, feedStage, target_xW);
        if (res.xW <= target_xW) {
          R_high = R_mid;
        } else {
          R_low = R_mid;
        }
      }

      return {
        R: R_high,
        achieved_xW: simulateWithFixedFeed(xD, zF, R_high, q, totalStages, feedStage, target_xW).xW,
        feasible: true
      };
    }

    // === ç»˜å›¾å‡½æ•° - ç¼©å°ç»˜å›¾åŒºåŸŸï¼Œä¿®å¤xæ ‡ç­¾è¶…å‡ºè¾¹ç•Œé—®é¢˜ ===
    function drawMTStatic(xD, xW, R, zF, q) {
      const svg = document.getElementById('mtPlot');
      svg.innerHTML = '';
      const size = 550;
      const margin = 35; // å¢åŠ åº•éƒ¨è¾¹è·ï¼Œç»™xè½´æ ‡ç­¾ç•™å‡ºç©ºé—´
      const plotSize = size - 2 * margin; // ç¼©å°ç»˜å›¾åŒºåŸŸ
      const offsetX = 60; // è°ƒæ•´æ°´å¹³åç§»ï¼Œé¿å…å·¦ä¾§æ‹¥æŒ¤

      // xåæ ‡è½¬æ¢å‡½æ•°ï¼šè°ƒæ•´åç§»å’Œç¼©æ”¾
      const xToSvg = x => margin + offsetX + x * plotSize;
      const yToSvg = y => size - margin - y * plotSize;

      // å¯¹è§’çº¿ - ç¼©å°åç»˜åˆ¶
      addLine(svg, xToSvg(0), yToSvg(0), xToSvg(1), yToSvg(1), '#ddd', '4,4', 2);
      
      // å¹³è¡¡çº¿ - ç¼©å°åç»˜åˆ¶
      let eqPath = "M";
      for (let x=0; x<=1; x+=0.01) eqPath += ` ${xToSvg(x)},${yToSvg(equilibrium(x))}`;
      addPath(svg, eqPath, 'blue', 2);

      // qçº¿ - ç¼©å°åç»˜åˆ¶
      if (Math.abs(q - 1) < 1e-6) {
        addLine(svg, xToSvg(zF), yToSvg(0), xToSvg(zF), yToSvg(1), '#8e44ad', '3,3', 2);
      } else {
        const a = q / (q - 1);
        const b = -zF / (q - 1);
        let x1 = 0, y1 = b;
        let x2 = 1, y2 = a + b;
        if (y1 < 0) { y1 = 0; x1 = -b/a; }
        if (y1 > 1) { y1 = 1; x1 = (1-b)/a; }
        if (y2 < 0) { y2 = 0; x2 = -b/a; }
        if (y2 > 1) { y2 = 1; x2 = (1-b)/a; }
        addLine(svg, xToSvg(x1), yToSvg(y1), xToSvg(x2), yToSvg(y2), '#8e44ad', '3,3', 2);
      }

      // ç²¾é¦æ®µæ“ä½œçº¿ - ç¼©å°åç»˜åˆ¶
      const yRect0 = xD/(R+1);
      addLine(svg, xToSvg(0), yToSvg(yRect0), xToSvg(xD), yToSvg(xD), 'red', null, 2);

      // æé¦æ®µæ“ä½œçº¿ - ç¼©å°åç»˜åˆ¶
      const D = (zF - xW)/(xD - xW);
      const W = 1 - D;
      const F = 1;
      const L_bar = R*D + q*F;
      const V_bar = (R+1)*D - (1 - q)*F;
      const slope_s = L_bar / V_bar;
      const inter_s = - (W * xW) / V_bar;
      let yStrip0 = inter_s;
      let yStrip1 = slope_s + inter_s;
      let xStrip0 = 0;
      let xStrip1 = 1;
      if (yStrip0 < 0) { yStrip0 = 0; xStrip0 = -inter_s / slope_s; }
      if (yStrip0 > 1) { yStrip0 = 1; xStrip0 = (1-inter_s) / slope_s; }
      if (yStrip1 < 0) { yStrip1 = 0; xStrip1 = -inter_s / slope_s; }
      if (yStrip1 > 1) { yStrip1 = 1; xStrip1 = (1-inter_s) / slope_s; }
      addLine(svg, xToSvg(xStrip0), yToSvg(yStrip0), xToSvg(xStrip1), yToSvg(yStrip1), 'purple', null, 2);

      // å…³é”®ç‚¹ - ç¼©å°åç»˜åˆ¶
      addCircle(svg, xToSvg(xD), yToSvg(xD), 4, 'red');
      addCircle(svg, xToSvg(xW), yToSvg(xW), 4, 'purple');

      // åæ ‡è½´ - ç¼©å°åç»˜åˆ¶
      addLine(svg, xToSvg(0), yToSvg(0), xToSvg(1), yToSvg(0), 'black', null, 1.5);
      addLine(svg, xToSvg(0), yToSvg(0), xToSvg(0), yToSvg(1), 'black', null, 1.5);

      // Xè½´åˆ»åº¦ - è°ƒæ•´ä½ç½®é¿å…è¶…å‡º
      for (let i = 0; i <= 10; i++) {
        const xVal = i / 10;
        const xPx = xToSvg(xVal);
        addLine(svg, xPx, yToSvg(0), xPx, yToSvg(0) + 5, 'black', null, 1);
        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("x", xPx);
        text.setAttribute("y", yToSvg(0) + 20); // å‘ä¸‹ç§»åŠ¨åˆ»åº¦æ–‡å­—
        text.setAttribute("font-size", "11");
        text.setAttribute("text-anchor", "middle");
        text.textContent = xVal.toFixed(1);
        svg.appendChild(text);
      }

      // Yè½´åˆ»åº¦ - è°ƒæ•´ä½ç½®
      for (let i = 0; i <= 10; i++) {
        const yVal = i / 10;
        const yPx = yToSvg(yVal);
        addLine(svg, xToSvg(0) - 5, yPx, xToSvg(0), yPx, 'black', null, 1);
        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("x", xToSvg(0) - 15); // å‘å·¦è°ƒæ•´ï¼Œé¿å…æ‹¥æŒ¤
        text.setAttribute("y", yPx + 4);
        text.setAttribute("font-size", "11");
        text.setAttribute("text-anchor", "end");
        text.textContent = yVal.toFixed(1);
        svg.appendChild(text);
      }

      // è½´æ ‡ç­¾ - è°ƒæ•´ä½ç½®ï¼Œç¡®ä¿å®Œå…¨æ˜¾ç¤º
      // Xè½´æ ‡ç­¾ï¼šå¤§å¹…å‘ä¸‹ç§»åŠ¨ï¼Œç¡®ä¿ä¸è¶…å‡ºSVGè¾¹ç•Œ
      addText(svg, xToSvg(0.5), size + 15, "x (æ¶²ç›¸æ‘©å°”åˆ†æ•°)", "middle", 12);
      
      // Yè½´æ ‡ç­¾ï¼šè°ƒæ•´ä½ç½®ï¼Œé¿å…è¶…å‡º
      const yLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
      yLabel.setAttribute("x", margin + offsetX - 30);
      yLabel.setAttribute("y", margin + 30);
      yLabel.setAttribute("font-size", "12");
      yLabel.setAttribute("text-anchor", "middle");
      yLabel.setAttribute("transform", "rotate(-90 " + (margin + offsetX - 30) + " " + (margin + 30) + ")");
      yLabel.textContent = "y (æ°”ç›¸æ‘©å°”åˆ†æ•°)";
      svg.appendChild(yLabel);
    }

    function drawStepAtIndex(index) {
      const svg = document.getElementById('mtPlot');
      svg.querySelectorAll('.step-line, .step-label').forEach(el => el.remove());

      if (index < 0) return;

      const size = 550;
      const margin = 35; // ä¸drawMTStaticä¿æŒä¸€è‡´çš„è¾¹è·
      const plotSize = size - 2 * margin;
      const offsetX = 60; // ä¸drawMTStaticä¿æŒä¸€è‡´çš„åç§»

      const xToSvg = x => margin + offsetX + x * plotSize;
      const yToSvg = y => size - margin - y * plotSize;

      // é€æ¿æ¼”ç¤ºçš„çº¿æ¡ä¹Ÿä½¿ç”¨ç¼©å°åçš„åæ ‡ç³»ç»Ÿ
      for (let i = 0; i <= index; i++) {
        const step = currentSteps[i];
        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line.setAttribute("x1", xToSvg(step.from.x));
        line.setAttribute("y1", yToSvg(step.from.y));
        line.setAttribute("x2", xToSvg(step.to.x));
        line.setAttribute("y2", yToSvg(step.to.y));
        line.setAttribute("stroke", "#2c3e50");
        line.setAttribute("stroke-width", "1.8");
        line.classList.add("step-line");
        svg.appendChild(line);

        if (step.type === 'vertical' && step.stage !== undefined) {
          const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
          text.setAttribute("x", xToSvg(step.to.x) + 6);
          text.setAttribute("y", yToSvg(step.to.y) - 6);
          text.setAttribute("font-size", "12");
          text.setAttribute("fill", "#d35400");
          text.textContent = `#${step.stage}`;
          text.classList.add("step-label");
          svg.appendChild(text);
        }
      }

      if (index >= 0 && currentSteps[index].type === 'vertical') {
        const stage = currentSteps[index].stage;
        document.getElementById('currentStage').textContent = stage;
        highlightTowerStage(stage);
      }
    }

    function drawTower(N) {
      const svg = document.getElementById('towerSvg');
      svg.innerHTML = '';
      const width = 200, height = 600;
      const towerX = 80, towerWidth = 40;
      const topY = 80, bottomY = 500;
      const plateSpacing = (bottomY - topY) / (N + 1);

      // å¡”ä½“
      addRect(svg, towerX, topY, towerWidth, bottomY - topY, '#333', '#f9f9f9');

      // å¡”æ¿
      for (let i = 1; i <= N; i++) {
        const y = topY + i * plateSpacing;
        addLine(svg, towerX, y, towerX + towerWidth, y, '#555', null, 1.5, `plate-${i}`);
        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("x", towerX - 10);
        text.setAttribute("y", y + 4);
        text.setAttribute("font-size", "12");
        text.setAttribute("text-anchor", "end");
        text.textContent = `#${i}`;
        svg.appendChild(text);
      }

      // å†·å‡å™¨
      addRect(svg, towerX - 10, topY - 30, towerWidth + 20, 30, '#27ae60', '#5dcfdb', 'condenser');
      addText(svg, towerX + towerWidth/2, topY - 15, "å†·å‡å™¨", "middle");

      // å†æ²¸å™¨
      addRect(svg, towerX - 10, bottomY , towerWidth + 20, 30, '#db695d', '#db5dcf', 'reboiler');
      addText(svg, towerX + towerWidth/2, bottomY + 25, "å†æ²¸å™¨", "middle");

      // è¿›æ–™å£
      const feedY = (topY + bottomY) / 2;
      addLine(svg, 30, feedY, towerX, feedY, '#8e44ad', null, 2);
      addText(svg, 20, feedY - 5, "è¿›æ–™", "end");

      // å‡ºæ–™å£
      addLine(svg, towerX + towerWidth+10, topY-15 , width - 10, topY -15, '#2980b9', null, 2);
      addLine(svg, towerX + towerWidth, topY+2 , width - 10, topY +2, '#2980b9', null, 2);

      addText(svg, width - 5, topY + 15, "å¡”é¡¶", "start");
      addLine(svg, towerX + towerWidth+10, bottomY+15 , width - 10, bottomY+15, '#2980b9', null, 2);
      addLine(svg, towerX + towerWidth, bottomY , width - 10, bottomY, '#2980b9', null, 2);
      addText(svg, width - 5, bottomY - 25, "å¡”é‡œ", "start");
    }

    function highlightTowerStage(stage) {
      document.querySelectorAll('#towerSvg .highlight').forEach(el => el.remove());
      if (!stage) return;
      const plate = document.querySelector(`#towerSvg #plate-${stage}`);
      if (plate) {
        const bbox = plate.getBBox();
        const highlight = document.createElementNS("http://www.w3.org/2000/svg", "rect");
        highlight.setAttribute("x", bbox.x - 2);
        highlight.setAttribute("y", bbox.y - 2);
        highlight.setAttribute("width", bbox.width + 4);
        highlight.setAttribute("height", 4);
        highlight.setAttribute("fill", "#f39c12");
        highlight.setAttribute("opacity", "0.7");
        highlight.classList.add("highlight");
        plate.parentNode.appendChild(highlight);
      }
    }

    // ç»˜å›¾è¾…åŠ©å‡½æ•°
    function addLine(svg, x1, y1, x2, y2, color, dash = null, width = 1, id = null) {
      const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
      line.setAttribute("x1", x1); line.setAttribute("y1", y1);
      line.setAttribute("x2", x2); line.setAttribute("y2", y2);
      line.setAttribute("stroke", color);
      line.setAttribute("stroke-width", width);
      if (dash) line.setAttribute("stroke-dasharray", dash);
      if (id) line.setAttribute("id", id);
      svg.appendChild(line);
    }
    function addRect(svg, x, y, w, h, stroke, fill = 'none', id = null) {
      const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
      rect.setAttribute("x", x); rect.setAttribute("y", y);
      rect.setAttribute("width", w); rect.setAttribute("height", h);
      if (stroke) rect.setAttribute("stroke", stroke);
      rect.setAttribute("fill", fill);
      if (id) rect.setAttribute("id", id);
      svg.appendChild(rect);
    }
       function addCircle(svg, cx, cy, r, fill) {
      const c = document.createElementNS("http://www.w3.org/2000/svg", "circle");
      c.setAttribute("cx", cx); c.setAttribute("cy", cy); c.setAttribute("r", r);
      c.setAttribute("fill", fill);
      svg.appendChild(c);
    }
    function addPath(svg, d, stroke, width) {
      const p = document.createElementNS("http://www.w3.org/2000/svg", "path");
      p.setAttribute("d", d);
      p.setAttribute("fill", "none");
      p.setAttribute("stroke", stroke);
      p.setAttribute("stroke-width", width);
      svg.appendChild(p);
    }
    function addText(svg, x, y, txt, anchor = "start", fontSize = 12) {
      const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
      t.setAttribute("x", x);
      t.setAttribute("y", y);
      t.setAttribute("font-size", fontSize);
      t.setAttribute("text-anchor", anchor);
      t.textContent = txt;
      svg.appendChild(t);
    }

    // æ›´æ–°æ•°æ®è¡¨æ ¼
    function updateDataTable() {
      const tbody = document.getElementById('dataBody');
      tbody.innerHTML = '';
      plateData.forEach(row => {
        if (row.stage === 0) return;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row.stage}</td>
          <td>${row.x.toFixed(4)}</td>
          <td>${row.y.toFixed(4)}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // å¯¼å‡ºCSVï¼ˆä¿®å¤ä¹±ç ï¼‰
    function exportDataToCSV() {
      if (plateData.length <= 1) {
        alert("æš‚æ— æ•°æ®å¯å¯¼å‡ºï¼Œè¯·å…ˆè¿è¡Œè®¡ç®—ã€‚");
        return;
      }

      let csvContent = "Stage,x,y\n"; // åˆ—åè‹±æ–‡ï¼Œé¿å…ç¼–ç é—®é¢˜
      plateData.forEach(row => {
        if (row.stage === 0) return; // è·³è¿‡å†·å‡å™¨
        csvContent += `${row.stage},${row.x.toFixed(6)},${row.y.toFixed(6)}\n`;
      });

      const bom = "\uFEFF"; // UTF-8 BOM
      const blob = new Blob([bom + csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.setAttribute("href", url);
      const safeAlpha = currentAlpha.toFixed(1).replace('.', '_');
      link.setAttribute("download", `distillation_data_alpha_${safeAlpha}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }

    // === æµ‹éªŒç›¸å…³å‡½æ•° ===
    // åˆå§‹åŒ–æµ‹éªŒé¢˜ç›®
    initQuizQuestions();

    // æ‰“å¼€æµ‹éªŒæ¨¡æ€æ¡†
    function openQuizModal() {
      document.getElementById('quizModal').style.display = 'flex';
      generateQuizQuestions();
      document.getElementById('quizResult').style.display = 'none';
    }

    // å…³é—­æµ‹éªŒæ¨¡æ€æ¡†
    function closeQuizModal() {
      document.getElementById('quizModal').style.display = 'none';
    }

    // éšæœºç”Ÿæˆ5é“ä¸é‡å¤çš„é¢˜ç›®
    function generateQuizQuestions() {
      const questionsContainer = document.getElementById('quizQuestions');
      questionsContainer.innerHTML = '';
      quizQuestions = [];

      // ä»30é“é¢˜ä¸­éšæœºæŠ½å–5é“ä¸é‡å¤çš„é¢˜ç›®
      const shuffledQuestions = [...allQuizQuestions].sort(() => 0.5 - Math.random());
      quizQuestions = shuffledQuestions.slice(0, 5);

      // æ¸²æŸ“é¢˜ç›®
      quizQuestions.forEach((q, index) => {
        const questionEl = document.createElement('div');
        questionEl.className = 'quiz-question';
        questionEl.innerHTML = `
          <h4>${index + 1}. ${q.question}</h4>
          <div class="quiz-options">
            ${q.options.map((option, optIndex) => `
              <div class="quiz-option">
                <input type="radio" name="q${q.id}" id="q${q.id}_opt${optIndex}" value="${optIndex}">
                <label for="q${q.id}_opt${optIndex}">${String.fromCharCode(65 + optIndex)}. ${option}</label>
              </div>
            `).join('')}
          </div>
          <div class="question-feedback" id="feedback_q${q.id}"></div>
        `;
        questionsContainer.appendChild(questionEl);
      });
    }

    // æäº¤ç­”æ¡ˆå¹¶åˆ¤åˆ†
    function submitQuiz() {
      let score = 0;
      const total = quizQuestions.length;

      // æ£€æŸ¥æ¯é“é¢˜çš„ç­”æ¡ˆ
      quizQuestions.forEach(q => {
        const selectedOption = document.querySelector(`input[name="q${q.id}"]:checked`);
        const feedbackEl = document.getElementById(`feedback_q${q.id}`);
        feedbackEl.style.display = 'block';

        if (!selectedOption) {
          // æœªé€‰æ‹©ç­”æ¡ˆ
          feedbackEl.className = 'question-feedback feedback-incorrect';
          feedbackEl.innerHTML = `<p>âŒ æœªé€‰æ‹©ç­”æ¡ˆï¼æ­£ç¡®ç­”æ¡ˆï¼š${String.fromCharCode(65 + q.answer)}. ${q.options[q.answer]}</p>
                                 <div class="question-explanation">ğŸ’¡ è§£æï¼š${q.explanation}</div>`;
        } else {
          const userAnswer = parseInt(selectedOption.value);
          if (userAnswer === q.answer) {
            // å›ç­”æ­£ç¡®
            score++;
            feedbackEl.className = 'question-feedback feedback-correct';
            feedbackEl.innerHTML = `<p>âœ… å›ç­”æ­£ç¡®ï¼</p>
                                   <div class="question-explanation">ğŸ’¡ è§£æï¼š${q.explanation}</div>`;
          } else {
            // å›ç­”é”™è¯¯
            feedbackEl.className = 'question-feedback feedback-incorrect';
            feedbackEl.innerHTML = `<p>âŒ å›ç­”é”™è¯¯ï¼ä½ çš„ç­”æ¡ˆï¼š${String.fromCharCode(65 + userAnswer)}. ${q.options[userAnswer]}<br>
                                   æ­£ç¡®ç­”æ¡ˆï¼š${String.fromCharCode(65 + q.answer)}. ${q.options[q.answer]}</p>
                                   <div class="question-explanation">ğŸ’¡ è§£æï¼š${q.explanation}</div>`;
          }
        }
      });

      // æ˜¾ç¤ºæµ‹éªŒç»“æœ
      const resultEl = document.getElementById('quizResult');
      const resultTitleEl = document.getElementById('resultTitle');
      const resultDetailsEl = document.getElementById('resultDetails');

      resultEl.style.display = 'block';
      if (score >= total * 0.8) {
        resultEl.className = 'quiz-result result-pass';
        resultTitleEl.textContent = `ğŸ‰ æ­å–œï¼å¾—åˆ†ï¼š${score}/${total}ï¼Œä¼˜ç§€ï¼`;
      } else if (score >= total * 0.6) {
        resultEl.className = 'quiz-result result-pass';
        resultTitleEl.textContent = `ğŸ‘ ä¸é”™ï¼å¾—åˆ†ï¼š${score}/${total}ï¼Œåˆæ ¼ï¼`;
      } else {
        resultEl.className = 'quiz-result result-fail';
        resultTitleEl.textContent = `âš ï¸ ç»§ç»­åŠªåŠ›ï¼å¾—åˆ†ï¼š${score}/${total}ï¼Œæœªåˆæ ¼ï¼`;
      }

      // æ˜¾ç¤ºç­”é¢˜è¯¦æƒ…ç»Ÿè®¡
      resultDetailsEl.innerHTML = `
        <p>æ€»é¢˜æ•°ï¼š${total} é“</p>
        <p>ç­”å¯¹ï¼š${score} é“</p>
        <p>ç­”é”™/æœªç­”ï¼š${total - score} é“</p>
        <p>æ­£ç¡®ç‡ï¼š${((score / total) * 100).toFixed(1)}%</p>
      `;

      // ç¦ç”¨æ‰€æœ‰é€‰é¡¹ï¼Œé˜²æ­¢å†æ¬¡é€‰æ‹©
      document.querySelectorAll('.quiz-option input').forEach(input => {
        input.disabled = true;
      });
    }

    // é‡ç½®å½“å‰æµ‹éªŒï¼ˆé‡æ–°é€‰æ‹©ç­”æ¡ˆï¼‰
    function resetQuiz() {
      // æ¸…ç©ºæ‰€æœ‰é€‰æ‹©å’Œåé¦ˆ
      quizQuestions.forEach(q => {
        const inputs = document.querySelectorAll(`input[name="q${q.id}"]`);
        inputs.forEach(input => {
          input.checked = false;
          input.disabled = false;
        });
        const feedbackEl = document.getElementById(`feedback_q${q.id}`);
        feedbackEl.style.display = 'none';
        feedbackEl.innerHTML = '';
      });

      // éšè—ç»“æœ
      document.getElementById('quizResult').style.display = 'none';
    }

    // å¼€å§‹æ–°çš„æµ‹éªŒï¼ˆé‡æ–°æŠ½é¢˜ï¼‰
    function startNewQuiz() {
      generateQuizQuestions();
      document.getElementById('quizResult').style.display = 'none';
    }

    // === æ§åˆ¶é€»è¾‘ ===
    function runFullSimulation() {
      try {
        clearInterval(animationInterval);
        document.getElementById('stepBtn').textContent = "â–¶ é€æ¿æ¼”ç¤º";
        document.getElementById('currentStage').textContent = "â€”";

        currentAlpha = parseFloat(document.getElementById('alpha').value);
        const zF = parseFloat(document.getElementById('zF').value);
        const xD = parseFloat(document.getElementById('xD').value);
        const R = parseFloat(document.getElementById('R').value);
        const q = parseFloat(document.getElementById('q').value);
        const feedStageInput = parseInt(document.getElementById('feedStage').value);

        // æ›´æ–°å‚æ•°æ˜¾ç¤º
        document.getElementById('alphaValue').textContent = currentAlpha.toFixed(2);
        document.getElementById('zFValue').textContent = zF.toFixed(2);
        document.getElementById('xDValue').textContent = xD.toFixed(2);
        document.getElementById('RValue').textContent = R.toFixed(1);
        document.getElementById('qValue').textContent = q.toFixed(1);
        document.getElementById('feedStageValue').textContent = feedStageInput === 0 ? 'è‡ªåŠ¨' : feedStageInput;

        // å‚æ•°éªŒè¯
        if (xD <= zF) {
          document.getElementById('results').innerHTML = "é”™è¯¯ï¼šx<sub>D</sub> å¿…é¡»å¤§äº z<sub>F</sub>";
          return;
        }

        const Rmin = calcRmin(xD, zF, q);
        if (R <= Rmin) {
          document.getElementById('results').innerHTML = `R å¿…é¡»å¤§äº R<sub>min</sub>=${Rmin.toFixed(2)}`;
          return;
        }

        // è®¡ç®—xW
        let xW;
        if (feedStageInput === 0) {
          xW = estimateXW(xD, zF, R, q);
        } else {
          xW = 0.05;
        }

        // é€æ¿è®¡ç®—
        const { steps, N } = steppingDetailed(xD, xW, R, zF, q);

        // ä¿å­˜å…¨å±€å˜é‡
        global_xD = xD; global_xW = xW; global_R = R; global_zF = zF; global_q = q;
        currentSteps = steps;
        currentStepIndex = -1;

        // æ›´æ–°ç»“æœæ˜¾ç¤º
        let resultsHTML = `
          Î± = ${currentAlpha.toFixed(2)}<br>
          R<sub>min</sub> = ${Rmin.toFixed(2)}<br>
          x<sub>W</sub> = ${xW.toFixed(4)}<br>
          ç†è®ºæ¿æ•° N = ${N}ï¼ˆå«å†æ²¸å™¨ï¼‰
        `.replace(/sub>/g, 'sub>');

        if (R / Rmin < 1.1) {
          resultsHTML += '<br><span class="warning">âš ï¸ R æ¥è¿‘æœ€å°å›æµæ¯”</span>';
        }

        document.getElementById('results').innerHTML = resultsHTML;

        // æ›´æ–°æ–¹ç¨‹æ˜¾ç¤º
        let qLineEq, stripEq;
        if (Math.abs(q - 1) < 1e-6) {
          qLineEq = `qçº¿: x = ${zF.toFixed(3)}`;
        } else {
          const a = (q / (q - 1)).toFixed(3);
          const b = (-zF / (q - 1)).toFixed(3);
          qLineEq = `qçº¿: y = ${a}x ${b >= 0 ? '+' : ''} ${b}`;
        }
        const D = (zF - xW) / (xD - xW);
        const W = 1 - D;
        const F = 1;
        const L_bar = R*D + q*F;
        const V_bar = (R+1)*D - (1 - q)*F;
        const slope_s = (L_bar / V_bar).toFixed(3);
        const inter_s = (-W * xW / V_bar).toFixed(4);
        stripEq = `æé¦æ®µ: y = ${slope_s}x ${inter_s >= 0 ? '+' : ''} ${inter_s}`;
        document.getElementById('equations').innerHTML = `${qLineEq}<br>${stripEq}`;

        // ç»˜åˆ¶å›¾è¡¨å’Œè¡¨æ ¼
        drawMTStatic(xD, xW, R, zF, q);
        drawTower(N);
        updateDataTable();
      } catch (e) {
        console.error("runFullSimulation å‘ç”Ÿé”™è¯¯:", e);
        document.getElementById('results').innerHTML = "è®¡ç®—å‘ç”Ÿé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥æˆ–åˆ·æ–°é¡µé¢ã€‚";
      }
    }

    function startStepByStep() {
      if (currentSteps.length === 0) {
        alert("è¯·å…ˆç‚¹å‡»ã€Œé‡æ–°è®¡ç®—ã€ç”Ÿæˆæµç¨‹ï¼");
        return;
      }
      const btn = document.getElementById('stepBtn');
      if (btn.textContent.includes("â–¶")) {
        btn.textContent = "â¸ æš‚åœ";
        animationInterval = setInterval(() => {
          if (currentStepIndex < currentSteps.length - 1) {
            currentStepIndex++;
            drawStepAtIndex(currentStepIndex);
          } else {
            clearInterval(animationInterval);
            btn.textContent = "âœ… å®Œæˆ";
          }
        }, 900);
      } else if (btn.textContent.includes("â¸")) {
        clearInterval(animationInterval);
        btn.textContent = "â–¶ ç»§ç»­";
      } else {
        btn.textContent = "â¸ æš‚åœ";
        animationInterval = setInterval(() => {
          if (currentStepIndex < currentSteps.length - 1) {
            currentStepIndex++;
            drawStepAtIndex(currentStepIndex);
          } else {
            clearInterval(animationInterval);
            btn.textContent = "âœ… å®Œæˆ";
          }
        }, 900);
      }
    }

    function resetDemo() {
      clearInterval(animationInterval);
      currentStepIndex = -1;
      document.getElementById('stepBtn').textContent = "â–¶ é€æ¿æ¼”ç¤º";
      document.getElementById('currentStage').textContent = "â€”";
      drawStepAtIndex(-1);
      highlightTowerStage(null);
    }

    // è¿›æ–™ä½ç½®ç ”ç©¶ - ä¼˜åŒ–è¡¨æ ¼æ˜¾ç¤º
    async function runFeedStageStudy() {
      const xD = parseFloat(document.getElementById('xD').value);
      const zF = parseFloat(document.getElementById('zF').value);
      const q = parseFloat(document.getElementById('q').value);
      const R_base = parseFloat(document.getElementById('R').value);

      const xW_base = estimateXW(xD, zF, R_base, q);
      const { N: totalStages } = steppingDetailed(xD, xW_base, R_base, zF, q);
      const target_xW = xW_base;

      if (totalStages > 50) {
        document.getElementById('feedStudyPlot').innerHTML = `
          <p style="color:red; text-align:center;">æ€»æ¿æ•°è¿‡å¤šï¼ˆN=${totalStages}ï¼‰ï¼Œå»ºè®®å¢å¤§ R ä»¥å‡å°‘æ¿æ•°åå†åˆ†æã€‚</p>
        `;
        return;
      }

      document.getElementById('feedStudyPlot').innerHTML = `
        <p style="color:#34495e; text-align:center;">æ­£åœ¨åˆ†æ Î±=${currentAlpha.toFixed(2)} ä¸‹ï¼Œ${totalStages} å—æ¿çš„ä¸åŒè¿›æ–™ä½ç½®...</p>
      `;

      const results = [];
      const minFeed = 1;
      const maxFeed = totalStages;

      for (let nf = minFeed; nf <= maxFeed; nf++) {
        await new Promise(r => setTimeout(r, 5));
        const res = findMinRForFeedStage(xD, zF, q, totalStages, nf, target_xW);
        if (res.feasible && isFinite(res.R)) {
          results.push({ feedStage: nf, R: res.R });
        }
      }

      if (results.length === 0) {
        document.getElementById('feedStudyPlot').innerHTML = `
          <p style="color:red; text-align:center;">æœªæ‰¾åˆ°å¯è¡Œè§£ï¼Œè¯·æ£€æŸ¥å‚æ•°è®¾ç½®ã€‚</p>
        `;
        return;
      }

      const best = results.reduce((a, b) => a.R < b.R ? a : b);

      // ä¼˜åŒ–è¡¨æ ¼å¸ƒå±€ï¼Œæ–‡å­—é›†ä¸­æ˜¾ç¤º
      let plotHTML = `
        <h4 style="margin-top:0; margin-bottom:10px; color:#2c3e50; text-align:center;">
          å›æµæ¯” vs è¿›æ–™æ¿ä½ç½®ï¼ˆÎ±=${currentAlpha.toFixed(2)}, N=${totalStages}ï¼‰
        </h4>
        <div class="info-text">
          âœ… æœ€ä¼˜è¿›æ–™æ¿ï¼š<strong>#${best.feedStage}</strong>ï¼ˆæ‰€éœ€ R = ${best.R.toFixed(2)}ï¼‰
        </div>
        <div class="table-container">
          <table border="1" cellpadding="6" cellspacing="0">
            <thead>
              <tr style="background-color:#f0ad4e33;">
                <th>è¿›æ–™æ¿ #</th>
                <th>æ‰€éœ€ R</th>
                <th>ç›¸å¯¹èƒ½è€— â†‘</th>
              </tr>
            </thead>
            <tbody>
      `;

      results.forEach(r => {
        const rel = ((r.R - best.R) / best.R * 100).toFixed(1);
        const rowClass = r.feedStage === best.feedStage ? 'style="background-color:#d4edda; font-weight:bold;"' : '';
        plotHTML += `<tr ${rowClass}>
          <td>${r.feedStage}</td>
          <td>${r.R.toFixed(2)}</td>
          <td>${rel}%</td>
        </tr>`;
      });

      plotHTML += `
            </tbody>
          </table>
        </div>
        <div class="note-text">
          ğŸ’¡ èƒ½è€—æ­£æ¯”äº Rï¼›åç¦»æœ€ä¼˜è¿›æ–™å°†å¢åŠ å†æ²¸å™¨çƒ­è´Ÿè·
        </div>
      `;

      document.getElementById('feedStudyPlot').innerHTML = plotHTML;
    }

    // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
    document.getElementById('quizModal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('quizModal')) {
        closeQuizModal();
      }
    });

    document.getElementById('helpModal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('helpModal')) {
        closeHelpModal();
      }
    });

    // åˆå§‹åŒ–
    try {
        // æ»‘å—å®æ—¶å“åº”
        document.querySelectorAll('input').forEach(inp => inp.addEventListener('input', runFullSimulation));
        // åˆå§‹è®¡ç®—
        runFullSimulation();
    } catch (e) {
        console.error("é¡µé¢åˆå§‹åŒ–å‘ç”Ÿé”™è¯¯:", e);
        document.body.innerHTML = "<h2 style='text-align:center; margin-top:30px; color:#e74c3c;'>é¡µé¢åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä»£ç æˆ–åˆ·æ–°é‡è¯•ã€‚</h2>";
    }
    // ä½¿ç”¨è¯´æ˜æ§åˆ¶å‡½æ•°
    function openHelpModal() {
      document.getElementById('helpModal').style.display = 'flex';
    }
    function closeHelpModal() {
      document.getElementById('helpModal').style.display = 'none';
    }
  </script>
</body>
</html>