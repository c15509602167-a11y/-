<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ç²¾é¦å¡”è¿è¡Œè¿‡ç¨‹å½±å“å› ç´ åˆ†æ</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      max-width: 100%;
      margin: 0 auto;
      padding: 8px;
      background-color: #f5f5f5;
      font-size: 15px;
    }
    .panel {
      background: white;
      padding: 12px;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 10px;
    }
    h1 {
      font-size: 2.2em;
      margin: 5px 0 10px 0;
    }
    h3 {
      font-size: 1.4em;
      margin: 0 0 8px 0;
      color: #2c3e50;
    }
    h4 {
      font-size: 1.2em;
      margin: 5px 0;
    }
    h5 {
      margin: 0 0 8px 0;
      font-size: 14px;
      color: #2c3e50;
    }
    .control-panel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 8px;
      margin-bottom: 10px;
    }
    button {
      padding: 8px 12px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-size: 14px;
      white-space: nowrap;
      transition: background 0.3s;
    }
    button:hover {
      opacity: 0.9;
    }
    button.info-btn {
      background: #9b59b6;
    }
    input[type="range"] {
      width: 100%;
      accent-color: #2ecc71;
      margin: 3px 0;
      height: 8px;
    }
    label {
      display: block;
      font-weight: bold;
      color: #2c3e50;
      font-size: 14px;
    }
    .param-value {
      color: #27ae60;
      font-weight: bold;
      margin-left: 5px;
      font-size: 14px;
    }
    svg {
      background: #fff;
      border: 1px solid #eee;
      border-radius: 3px;
      width: 100%;
      height: auto;
    }
    
    .tower-svg {
      max-width: 150px;
      height: 460px;
      margin: 5px auto;
      display: block;
    }
    
    .plot-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .alert {
      background: #fff8e1;
      padding: 10px;
      border-left: 4px solid #ffc107;
      margin-top: 8px;
      font-size: 15px;
      font-weight: bold;
    }
    
    .param-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
    }
    .param-item {
      display: flex;
      flex-direction: column;
    }
    
    .main-grid {
      display: grid;
      grid-template-columns: 250px 1fr 320px;
      gap: 10px;
      align-items: start;
    }
    
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }
    .dashboard-card {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #e0e0e0;
      min-width: 0;
    }
    
    .gauge-container {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    .gauge {
      width: 100%;
      height: 24px;
      background: linear-gradient(to right, #e3f2fd, #bbdefb);
      border-radius: 3px;
      position: relative;
      overflow: hidden;
    }
    .gauge-bar {
      height: 100%;
      background: linear-gradient(to right, #2196f3, #64b5f6);
      border-radius: 3px;
      transition: width 0.3s ease;
    }
    .gauge-labels {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      margin-top: 4px;
    }
    .gauge-labels span {
      font-weight: bold;
      color: #37474f;
    }
    
    .efficiency-display {
      text-align: center;
    }
    .efficiency-value {
      font-size: 28px;
      font-weight: bold;
      color: #27ae60;
      margin-bottom: 8px;
    }
    .efficiency-bar {
      width: 100%;
      height: 10px;
      background: #ecf0f1;
      border-radius: 4px;
      overflow: hidden;
    }
    .efficiency-fill {
      height: 100%;
      background: linear-gradient(to right, #e74c3c, #f39c12, #2ecc71);
      border-radius: 4px;
      transition: width 0.3s ease;
    }
    
    .status-indicators {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .status-light {
      padding: 8px 10px;
      border-radius: 4px;
      font-size: 13px;
      font-weight: bold;
      text-align: center;
    }
    .status-light.normal {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .status-light.warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    .status-light.danger {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    #statusInfo {
      font-size: 15px;
      padding: 10px;
      background: #ecf0f1;
      border-radius: 4px;
      margin-top: 8px;
      font-weight: bold;
    }
    
    .right-control-panel {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .plot-box svg {
      width: 300px !important;
      height: 300px !important;
      margin: 0 auto;
      display: block;
    }
    
    .right-control-panel .alert {
      margin: 0;
      order: 1;
    }
    
    /* æ¨¡æ€æ¡†æ ·å¼ */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      animation: fadeIn 0.3s;
    }
    
    .modal-content {
      background-color: #fefefe;
      margin: 2% auto;
      padding: 0;
      border-radius: 8px;
      width: 80%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      animation: slideIn 0.3s;
    }
    
    .modal-header {
      background-color: #2c3e50;
      color: white;
      padding: 20px;
      border-radius: 8px 8px 0 0;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .modal-header h2 {
      margin: 0;
      font-size: 1.8em;
    }
    
    .modal-body {
      padding: 20px;
      line-height: 1.6;
    }
    
    .modal-body h3 {
      color: #2c3e50;
      margin-top: 20px;
      margin-bottom: 10px;
      font-size: 1.3em;
    }
    
    .modal-body h4 {
      color: #34495e;
      margin-top: 15px;
      margin-bottom: 8px;
      font-size: 1.1em;
    }
    
    .modal-body p {
      margin-bottom: 10px;
    }
    
    .modal-body ul {
      margin-bottom: 15px;
      padding-left: 20px;
    }
    
    .modal-body li {
      margin-bottom: 8px;
    }
    
    .modal-body strong {
      color: #2c3e50;
    }
    
    .close {
      color: white;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      line-height: 1;
    }
    
    .close:hover {
      color: #ecf0f1;
    }
    
    .highlight {
      background: #e8f4fd;
      padding: 10px;
      border-left: 4px solid #3498db;
      margin: 10px 0;
      border-radius: 4px;
    }
    
    .research-section {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 6px;
      margin: 15px 0;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideIn {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    @media (max-width: 768px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
      .dashboard-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      .plot-box svg {
        width: 100% !important;
        height: auto !important;
      }
      .modal-content {
        width: 95%;
        margin: 5% auto;
      }
    }
  </style>
</head>
<body>
  <h1>ç²¾é¦å¡”è¿è¡Œè¿‡ç¨‹å½±å“å› ç´ åˆ†æ</h1>

  <!-- ä¸»ç½‘æ ¼å¸ƒå±€ -->
  <div class="main-grid">
    <!-- å·¦ä¾§ï¼šå¡”ç»“æ„å’ŒçŠ¶æ€ -->
    <div>
      <div class="panel">
        <h3>ç²¾é¦å¡”ç»“æ„</h3>
        <svg class="tower-svg" id="towerSvg"></svg>
        <div id="statusInfo">å°±ç»ª - ç­‰å¾…æ¨¡æ‹Ÿ</div>
      </div>
    </div>

    <!-- ä¸­é—´ï¼šè¿è¡Œå‚æ•°ç›‘æ§å’Œè¶‹åŠ¿åˆ†æ -->
    <div>
      <div class="panel">
        <h3>è¿è¡Œå‚æ•°ç›‘æ§</h3>
        <div class="dashboard-grid">
          <div class="dashboard-card">
            <h5>ç²¾é¦æ®µè´Ÿè·</h5>
            <div class="gauge-container">
              <div class="gauge" id="rectTopLoad"></div>
              <div class="gauge-labels">
                <span>V: <span id="V_top">-</span> kmol/h</span>
                <span>L: <span id="L_top">-</span> kmol/h</span>
              </div>
            </div>
          </div>
          
          <div class="dashboard-card">
            <h5>æé¦æ®µè´Ÿè·</h5>
            <div class="gauge-container">
              <div class="gauge" id="rectBotLoad"></div>
              <div class="gauge-labels">
                <span>V': <span id="V_bot">-</span> kmol/h</span>
                <span>L': <span id="L_bot">-</span> kmol/h</span>
              </div>
            </div>
          </div>
          
          <div class="dashboard-card">
            <h5>åˆ†ç¦»æ•ˆç‡</h5>
            <div class="efficiency-display" id="efficiencyGauge">
              <div class="efficiency-value" id="effValue">-</div>
              <div class="efficiency-bar">
                <div class="efficiency-fill" id="effFill"></div>
              </div>
            </div>
          </div>
          
          <div class="dashboard-card">
            <h5>å¡”å†…çŠ¶æ€</h5>
            <div class="status-indicators">
              <div id="floodRisk" class="status-light normal">æ­£å¸¸</div>
              <div id="weirRisk" class="status-light normal">æ­£å¸¸</div>
            </div>
          </div>
        </div>
      </div>

      <div class="panel">
        <h3>è¶‹åŠ¿åˆ†æ</h3>
        <div class="plot-container">
          <div class="plot-box">
            <h4>æ¸©åº¦åˆ†å¸ƒ</h4>
            <svg id="tempPlot"></svg>
          </div>
          <div class="plot-box">
            <h4>çº¯åº¦è¶‹åŠ¿</h4>
            <svg id="purityPlot"></svg>
          </div>
        </div>
        <!-- è­¦å‘Šæ¡†å·²ä»è¶‹åŠ¿åˆ†æé¢æ¿ç§»é™¤ -->
      </div>
    </div>

    <!-- å³ä¾§ï¼šæ“ä½œå‚æ•°å’Œå¿«é€Ÿæ“ä½œ -->
    <div class="right-control-panel">
      <div class="panel">
        <h3>æ“ä½œå‚æ•°</h3>
        <div class="param-grid">
          <div class="param-item">
            <label>
              è¿›æ–™æµé‡ F (kmol/h): <span id="FValue" class="param-value">100</span>
              <input type="range" id="F" min="50" max="200" step="5" value="100">
            </label>
          </div>
          <div class="param-item">
            <label>
              è¿›æ–™ç»„æˆ z<sub>F</sub>: <span id="zFValue" class="param-value">0.50</span>
              <input type="range" id="zF" min="0.2" max="0.8" step="0.05" value="0.5">
            </label>
          </div>
          <div class="param-item">
            <label>
              å›æµæ¯” R: <span id="RValue" class="param-value">2.0</span>
              <input type="range" id="R" min="1.0" max="5.0" step="0.1" value="2.0">
            </label>
          </div>
          <div class="param-item">
            <label>
              å†æ²¸å™¨çƒ­è´Ÿè· Q (%): <span id="QValue" class="param-value">100</span>
              <input type="range" id="Q" min="60" max="140" step="5" value="100">
            </label>
          </div>
          <div class="param-item">
            <label>
              è¿›æ–™çƒ­çŠ¶å†µ q: <span id="qValue" class="param-value">1.0</span>
              <input type="range" id="qFeed" min="-0.2" max="1.5" step="0.1" value="1.0">
            </label>
          </div>
        </div>
      </div>

      <!-- è­¦å‘Šæ¡†ç§»åŠ¨åˆ°è¿™é‡Œ -->
      <div class="alert" id="alertBox" style="display:none;"></div>

      <div class="panel">
        <h3>å¿«é€Ÿæ“ä½œ</h3>
        <div class="control-panel">
          <button onclick="simulateStep()">â–¶ æ¨¡æ‹Ÿ</button>
          <button onclick="resetOperation()">â†º é‡ç½®</button>
          <button class="info-btn" onclick="showInfoModal()">ğŸ“– æ“ä½œä¸ç ”ç©¶</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ä¿¡æ¯æ¨¡æ€æ¡† -->
  <div id="infoModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span class="close" onclick="closeInfoModal()">&times;</span>
        <h2>ç²¾é¦å¡”æ¨¡æ‹Ÿå™¨ - æ“ä½œæŒ‡å—ä¸ç ”ç©¶æ–¹æ³•</h2>
      </div>
      <div class="modal-body">
        <h3>ä¸€ã€åŸºæœ¬åŸç†</h3>
        <p>æœ¬è½¯ä»¶åŸºäº<strong>McCabe-Thieleå›¾è§£æ³•</strong>å’Œ<strong>åŒç»„åˆ†ç²¾é¦ç‰©æ–™å¹³è¡¡</strong>åŸç†å¼€å‘ï¼Œé€šè¿‡æ¨¡æ‹Ÿä»¥ä¸‹æ ¸å¿ƒè¿‡ç¨‹å®ç°ï¼š</p>
        <ul>
          <li><strong>ç›¸å¹³è¡¡å…³ç³»</strong>ï¼šé‡‡ç”¨ç›¸å¯¹æŒ¥å‘åº¦Î±æè¿°æ°”æ¶²å¹³è¡¡ï¼Œy = Î±x / [1 + (Î± - 1)x]</li>
          <li><strong>ç‰©æ–™å¹³è¡¡</strong>ï¼šå…¨å¡”æ€»ç‰©æ–™å¹³è¡¡ F = D + Wï¼Œç»„åˆ†å¹³è¡¡ FÂ·z<sub>F</sub> = DÂ·x<sub>D</sub> + WÂ·x<sub>W</sub></li>
          <li><strong>æ“ä½œçº¿æ–¹ç¨‹</strong>ï¼šç²¾é¦æ®µ y = (R/(R+1))x + x<sub>D</sub>/(R+1)ï¼›æé¦æ®µ y = (L'/V')x - WÂ·x<sub>W</sub>/V'</li>
          <li><strong>qçº¿æ–¹ç¨‹</strong>ï¼šæè¿°è¿›æ–™çƒ­çŠ¶å†µï¼Œy = [q/(q-1)]x - z<sub>F</sub>/(q-1)</li>
          <li><strong>æ•ˆç‡æ¨¡å‹</strong>ï¼šç»¼åˆè€ƒè™‘å›æµæ¯”ã€çƒ­çŠ¶å†µqå’Œè´Ÿè·å¹³è¡¡å¯¹åˆ†ç¦»æ•ˆç‡çš„å½±å“</li>
        </ul>
        
        <div class="highlight">
          <strong>å…³é”®å‡è®¾ï¼š</strong>ç›¸å¯¹æŒ¥å‘åº¦æ’å®šã€ç†æƒ³æº¶æ¶²ã€æ’æ‘©å°”æµã€å¡”æ¿æ•ˆç‡å‡ä¸€
        </div>

        <h3>äºŒã€æ“ä½œè¯´æ˜</h3>
        <h4>1. æ“ä½œå‚æ•°è°ƒèŠ‚</h4>
        <ul>
          <li><strong>è¿›æ–™æµé‡ F</strong>ï¼š50-200 kmol/hï¼Œå½±å“å¡”å†…æ°”æ¶²è´Ÿè·å’Œåˆ†ç¦»æ—¶é—´</li>
          <li><strong>è¿›æ–™ç»„æˆ z<sub>F</sub></strong>ï¼š0.2-0.8ï¼Œè½»ç»„åˆ†åœ¨è¿›æ–™ä¸­çš„æ‘©å°”åˆ†æ•°</li>
          <li><strong>å›æµæ¯” R</strong>ï¼š1.0-5.0ï¼Œå›æµæ¶²é‡ä¸å¡”é¡¶äº§å“é‡çš„æ¯”å€¼ï¼Œå…³é”®æ“ä½œå‚æ•°</li>
          <li><strong>å†æ²¸å™¨çƒ­è´Ÿè· Q</strong>ï¼š60-140%ï¼Œå½±å“å¡”é‡œæ°”åŒ–é‡ï¼Œé—´æ¥æ”¹å˜V'å’ŒL'</li>
          <li><strong>è¿›æ–™çƒ­çŠ¶å†µ q</strong>ï¼š-0.2åˆ°1.5ï¼Œq&lt;1ä¸ºè¿‡çƒ­è’¸æ±½ï¼Œq=1ä¸ºé¥±å’Œæ¶²ä½“ï¼Œq&gt;1ä¸ºè¿‡å†·æ¶²ä½“</li>
        </ul>
        
        <h4>2. ç›‘æ§æŒ‡æ ‡è§£è¯»</h4>
        <ul>
          <li><strong>ç²¾é¦æ®µ/æé¦æ®µè´Ÿè·</strong>ï¼šæ˜¾ç¤ºæ°”ç›¸(V)å’Œæ¶²ç›¸(L)æµé‡ï¼Œçº¢è‰²ä¸ºæ°”ç›¸ï¼Œç»¿è‰²/æ©™è‰²ä¸ºæ¶²ç›¸</li>
          <li><strong>åˆ†ç¦»æ•ˆç‡</strong>ï¼šç»¼åˆè¯„ä¼°å¡”æ¿åˆ©ç”¨æ•ˆç‡ï¼Œç†æƒ³æƒ…å†µå¯è¾¾95%ä»¥ä¸Š</li>
          <li><strong>å¡”å†…çŠ¶æ€</strong>ï¼š
            <ul>
              <li><span style="color: #27ae60;">â— æ­£å¸¸</span>ï¼šæ“ä½œåœ¨å®‰å…¨èŒƒå›´å†…</li>
              <li><span style="color: #f39c12;">â— é«˜è´Ÿè·/ä½è´Ÿè·</span>ï¼šæ¥è¿‘æ“ä½œè¾¹ç•Œï¼Œéœ€è°¨æ…</li>
              <li><span style="color: #e74c3c;">â— æ¶²æ³›é£é™©/æ¼æ¶²é£é™©</span>ï¼šä¸¥é‡æ“ä½œé—®é¢˜ï¼Œéœ€ç«‹å³è°ƒæ•´</li>
            </ul>
          </li>
        </ul>

        <h4>3. å›¾å½¢ä¿¡æ¯</h4>
        <ul>
          <li><strong>æ¸©åº¦åˆ†å¸ƒ</strong>ï¼šæ²¿å¡”æ¿ä½ç½®çš„æ¸©åº¦å˜åŒ–æ›²çº¿ï¼Œåæ˜ ç»„åˆ†åˆ†å¸ƒ</li>
          <li><strong>çº¯åº¦è¶‹åŠ¿</strong>ï¼šè“è‰²ä¸ºå¡”é¡¶é¦å‡ºæ¶²x<sub>D</sub>ï¼Œçº¢è‰²ä¸ºå¡”é‡œæ®‹æ¶²x<sub>W</sub></li>
          <li><strong>å¡”ç»“æ„å›¾</strong>ï¼šå½©è‰²å¡”æ¿è¡¨ç¤ºæ¸©åº¦åˆ†å¸ƒï¼Œæ•°å­—æ˜¾ç¤ºå„æ¿æ¸©åº¦</li>
        </ul>

        <h3>ä¸‰ã€ç ”ç©¶æ€§å·¥ä½œå†…å®¹ä¸æ–¹æ³•</h3>
        
        <div class="research-section">
          <h4>ç ”ç©¶è¯¾é¢˜1ï¼šå›æµæ¯”å¯¹åˆ†ç¦»æ•ˆæœçš„å½±å“</h4>
          <p><strong>ç ”ç©¶ç›®æ ‡ï¼š</strong>æ¢ç©¶å›æµæ¯”ä¸äº§å“çº¯åº¦ã€èƒ½è€—çš„å…³ç³»ï¼Œç¡®å®šæœ€ä¼˜å›æµæ¯”</p>
          <p><strong>å®éªŒè®¾è®¡ï¼š</strong></p>
          <ul>
            <li>å›ºå®šå…¶ä»–å‚æ•°ï¼ˆF=100, z<sub>F</sub>=0.5, q=1.0, Q=100%ï¼‰</li>
            <li>åœ¨R=1.0~5.0èŒƒå›´å†…ï¼Œæ¯0.5ä¸ºä¸€ä¸ªå®éªŒç‚¹</li>
            <li>è®°å½•æ¯ä¸ªRå¯¹åº”çš„x<sub>D</sub>ã€x<sub>W</sub>å’Œåˆ†ç¦»æ•ˆç‡</li>
            <li>ç»˜åˆ¶R-x<sub>D</sub>æ›²çº¿å’ŒR-æ•ˆç‡æ›²çº¿</li>
          </ul>
          <p><strong>æ•°æ®åˆ†æï¼š</strong>å¯»æ‰¾çº¯åº¦éšRå¢åŠ è¶‹äºå¹³ç¼“çš„æ‹ç‚¹ï¼Œç»“åˆèƒ½è€—è€ƒè™‘æœ€ä¼˜æ“ä½œç‚¹</p>
        </div>

        <div class="research-section">
          <h4>ç ”ç©¶è¯¾é¢˜2ï¼šè¿›æ–™çƒ­çŠ¶å†µçš„ä¼˜åŒ–</h4>
          <p><strong>ç ”ç©¶ç›®æ ‡ï¼š</strong>åˆ†æqå€¼å¯¹å¡”å†…è´Ÿè·åˆ†å¸ƒå’Œåˆ†ç¦»æ•ˆç‡çš„å½±å“</p>
          <p><strong>å®éªŒè®¾è®¡ï¼š</strong></p>
          <ul>
            <li>å›ºå®šF=100, z<sub>F</sub>=0.5, R=2.0</li>
            <li>åœ¨q=-0.2~1.5èŒƒå›´å†…å˜åŒ–ï¼Œè§‚å¯ŸVã€V'ã€Lã€L'çš„å˜åŒ–</li>
            <li>åˆ†æä¸åŒqå€¼ä¸‹çš„æ¸©åº¦åˆ†å¸ƒæ›²çº¿å½¢æ€å˜åŒ–</li>
            <li>è¯„ä¼°qå¯¹æ¶²æ³›/æ¼æ¶²é£é™©çš„å½±å“</li>
          </ul>
          <p><strong>ç ”ç©¶é‡ç‚¹ï¼š</strong>qâ‰ 1æ—¶ç²¾é¦æ®µä¸æé¦æ®µè´Ÿè·ä¸å¹³è¡¡ç°è±¡ï¼Œä»¥åŠå…¶å¯¹å¡”æ¿æ•ˆç‡çš„å½±å“</p>
        </div>

        <div class="research-section">
          <h4>ç ”ç©¶è¯¾é¢˜3ï¼šæ“ä½œå¼¹æ€§ä¸æ•…éšœè¯Šæ–­</h4>
          <p><strong>ç ”ç©¶ç›®æ ‡ï¼š</strong>ç¡®å®šå¡”çš„æ“ä½œè¾¹ç•Œï¼Œå»ºç«‹æ•…éšœè¯Šæ–­ç­–ç•¥</p>
          <p><strong>å®éªŒå†…å®¹ï¼š</strong></p>
          <ul>
            <li><strong>æ¶²æ³›ç ”ç©¶ï¼š</strong>é€æ­¥å¢å¤§Fæˆ–Rï¼Œè®°å½•æ¶²æ³›å‘ç”Ÿçš„ä¸´ç•Œæ¡ä»¶</li>
            <li><strong>æ¼æ¶²ç ”ç©¶ï¼š</strong>é™ä½Ræˆ–Fï¼Œè§‚å¯Ÿæ¼æ¶²ç°è±¡çš„å‡ºç°</li>
            <li><strong>è¿›æ–™æ³¢åŠ¨ï¼š</strong>åœ¨å›ºå®šæ“ä½œæ¡ä»¶ä¸‹ï¼Œæ”¹å˜z<sub>F</sub>Â±0.2ï¼Œè§‚å¯Ÿç³»ç»Ÿå“åº”é€Ÿåº¦å’Œç¨³å®šæ€§</li>
            <li><strong>çƒ­è´Ÿè·æ‰°åŠ¨ï¼š</strong>é˜¶è·ƒæ”¹å˜Qå€¼Â±20%ï¼Œåˆ†æç³»ç»Ÿæ¢å¤æ—¶é—´</li>
          </ul>
        </div>

        <div class="research-section">
          <h4>ç ”ç©¶è¯¾é¢˜4ï¼šç»„åˆ†åˆ†ç¦»éš¾åº¦åˆ†æ</h4>
          <p><strong>ç ”ç©¶ç›®æ ‡ï¼š</strong>è€ƒå¯Ÿè¿›æ–™ç»„æˆå¯¹åˆ†ç¦»éš¾åº¦å’Œèƒ½è€—çš„å½±å“</p>
          <p><strong>å®éªŒè®¾è®¡ï¼š</strong></p>
          <ul>
            <li>åœ¨z<sub>F</sub>=0.2~0.8èŒƒå›´å†…ï¼Œå¯»æ‰¾è¾¾åˆ°ç›¸åŒäº§å“çº¯åº¦æ‰€éœ€çš„Rå€¼</li>
            <li>ç»˜åˆ¶z<sub>F</sub>-R<sub>min</sub>å…³ç³»æ›²çº¿</li>
            <li>åˆ†æè¿‘å…±æ²¸ç‰©ï¼ˆz<sub>F</sub>æ¥è¿‘0æˆ–1ï¼‰çš„åˆ†ç¦»ç‰¹æ€§</li>
            <li>è¯„ä¼°ä¸åŒè¿›æ–™ç»„æˆä¸‹çš„æ“ä½œçª—å£å®½åº¦</li>
          </ul>
        </div>

        <h3>å››ã€é«˜çº§ç ”ç©¶æŠ€å·§</h3>
        <ul>
          <li><strong>æ­£äº¤å®éªŒè®¾è®¡ï¼š</strong>é‡‡ç”¨L<sub>16</sub>(4<sup>5</sup>)æ­£äº¤è¡¨ï¼Œç³»ç»Ÿç ”ç©¶å¤šå› ç´ äº¤äº’ä½œç”¨</li>
          <li><strong>å“åº”é¢æ³•ï¼š</strong>å»ºç«‹Rå’ŒQå¯¹çº¯åº¦çš„å“åº”é¢æ¨¡å‹ï¼Œå¯»æ‰¾æœ€ä¼˜æ“ä½œåŒºåŸŸ</li>
          <li><strong>åŠ¨æ€æ¨¡æ‹Ÿï¼š</strong>è®°å½•çº¯åº¦è¶‹åŠ¿çš„æ—¶é—´åºåˆ—æ•°æ®ï¼Œåˆ†æç³»ç»Ÿå“åº”ç‰¹æ€§</li>
          <li><strong>æ•°æ®å¯¼å‡ºä¸åˆ†æï¼š</strong>æ‰‹åŠ¨è®°å½•å…³é”®æ•°æ®ï¼Œä½¿ç”¨Excelæˆ–Pythonè¿›è¡Œæ·±åº¦åˆ†æ</li>
        </ul>

        <h3>äº”ã€æ³¨æ„äº‹é¡¹</h3>
        <ul>
          <li>æ¯æ¬¡è°ƒæ•´å‚æ•°åç‚¹å‡»"æ¨¡æ‹Ÿ"æŒ‰é’®æ›´æ–°ç»“æœ</li>
          <li>å…³æ³¨è­¦å‘Šä¿¡æ¯ï¼Œçº¢è‰²è­¦å‘Šéœ€è¦ç«‹å³è°ƒæ•´æ“ä½œæ¡ä»¶</li>
          <li>å»ºè®®æ¯æ¬¡åªæ”¹å˜ä¸€ä¸ªå˜é‡ï¼Œä»¥æ˜ç¡®å› æœå…³ç³»</li>
          <li>å®é™…å·¥ä¸šåº”ç”¨ä¸­éœ€è€ƒè™‘å®‰å…¨è£•åº¦ï¼Œé¿å…åœ¨è¾¹ç•Œæ¡ä»¶ä¸‹é•¿æœŸæ“ä½œ</li>
        </ul>

        <div class="highlight">
          <strong>ç ”ç©¶ä»·å€¼ï¼š</strong>é€šè¿‡æœ¬æ¨¡æ‹Ÿå™¨ï¼Œå¯ä»¥æ·±å…¥ç†è§£ç²¾é¦å¡”"ä¸‰ä¼ ä¸€å"è€¦åˆæœºç†ï¼Œä¸ºå®é™…ç”Ÿäº§ä¼˜åŒ–å’Œæ§åˆ¶ç³»ç»Ÿè®¾è®¡æä¾›ç†è®ºæŒ‡å¯¼ã€‚
        </div>
      </div>
    </div>
  </div>

  <script>
    // === å…¨å±€å˜é‡ ===
    let currentF = 100;
    let currentZF = 0.5;
    let currentR = 2.0;
    let currentQ = 100;
    let currentQfeed = 1.0;
    let timeStep = 0;
    const alpha = 2.5;
    const xD_set = 0.95;
    const xW_set = 0.05;
    let history = [];

    // === ç‰©æ€§å‡½æ•° ===
    function equilibrium(x) {
      return (alpha * x) / (1 + (alpha - 1) * x);
    }

    function estimateTemp(x) {
      return 110 - 30 * x;
    }

    // === æ ¸å¿ƒæ¨¡æ‹Ÿå‡½æ•° ===
    function simulateStep() {
      timeStep += 1;

      // 1. è®¡ç®—äº§å“æµé‡
      const D = currentF * (currentZF - xW_set) / (xD_set - xW_set);
      const W = currentF - D;

      // 2. è®¡ç®—å†…éƒ¨æ°”æ¶²è´Ÿè·
      const V_top = (currentR + 1) * D;
      const L_top = currentR * D;
      const V_bot = V_top - (1 - currentQfeed) * currentF;
      const L_bot = L_top + currentQfeed * currentF;

      // 3. åˆ†ç¦»æ•ˆç‡
      const load_balance = Math.min(V_top / (V_bot + 1e-6), V_bot / (V_top + 1e-6));
      const separation_efficiency = 0.85 
        + (currentR - 2.0) * 0.05 
        - Math.abs(currentQfeed - 1.0) * 0.1
        + (load_balance - 0.5) * 0.1;
      
      const eff = Math.max(0.3, Math.min(0.99, separation_efficiency));

      // 4. äº§å“çº¯åº¦
      const zF_deviation = currentZF - 0.5;
      const q_deviation = currentQfeed - 1.0;
      
      let xD_actual = xD_set 
        + (currentR - 2.0) * 0.02
        - (100 - currentQ) * 0.001
        + zF_deviation * 0.6
        - q_deviation * 0.3
        + (eff - 0.85) * 0.3;
      
      xD_actual = Math.min(0.99, Math.max(0.65, xD_actual));

      let xW_actual = xW_set
        - (currentQ - 100) * 0.0005
        + (currentF - 100) * 0.0003
        + zF_deviation * 0.6
        + q_deviation * 0.3
        - (eff - 0.85) * 0.2;
      
      xW_actual = Math.min(0.25, Math.max(0.01, xW_actual));

      // 5. æ£€æŸ¥æ“ä½œé£é™©
      const floodRiskLevel = Math.max(V_top, V_bot) / 150;
      const weirRiskLevel = Math.min(L_top, L_bot) / 50;
      
      let alert = "";
      if (xD_actual < 0.90) {
        alert = "âš ï¸ å¡”é¡¶çº¯åº¦ä¸è¶³ï¼å¢å¤§å›æµæ¯”æˆ–é™ä½qå€¼ã€‚";
      } else if (xW_actual > 0.1) {
        alert = "âš ï¸ å¡”é‡œçº¯åº¦ä¸è¶³ï¼æ£€æŸ¥å†æ²¸å™¨æˆ–æé«˜qå€¼ã€‚";
      } else if (floodRiskLevel > 0.85) {
        alert = "ğŸš¨ æ¶²æ³›é£é™©ï¼é™ä½è¿›æ–™æµé‡æˆ–å›æµæ¯”ã€‚";
      } else if (weirRiskLevel < 0.3) {
        alert = "âš ï¸ æ¼æ¶²é£é™©ï¼å¢åŠ å›æµæ¯”æˆ–è¿›æ–™æµé‡ã€‚";
      }

      // 6. ä¿å­˜å†å²
      history.push({ 
        time: timeStep, 
        xD: xD_actual, 
        xW: xW_actual,
        V_top, L_top, V_bot, L_bot, eff,
        alert 
      });

      // 7. æ›´æ–°æ˜¾ç¤º
      updateStatus(xD_actual, xW_actual, alert);
      updateDashboard(V_top, L_top, V_bot, L_bot, eff, floodRiskLevel, weirRiskLevel);
      drawTowerWithTemp(xD_actual, xW_actual);
      drawTemperatureProfile(xD_actual, xW_actual);
      drawPurityTrend();

      const alertBox = document.getElementById('alertBox');
      if (alert) {
        alertBox.textContent = alert;
        alertBox.style.display = 'block';
      } else {
        alertBox.style.display = 'none';
      }
    }

    // === ç»˜å›¾å‡½æ•° ===
    function drawTowerWithTemp(xD, xW) {
      const svg = document.getElementById('towerSvg');
      svg.innerHTML = '';
      const width = 150, height = 460;
      const towerX = 55, towerWidth = 40;
      const topY = 50, bottomY = 430;
      const N = 10;

      const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
      rect.setAttribute("x", towerX);
      rect.setAttribute("y", topY);
      rect.setAttribute("width", towerWidth);
      rect.setAttribute("height", bottomY - topY);
      rect.setAttribute("fill", "#f0f0f0");
      rect.setAttribute("stroke", "#333");
      svg.appendChild(rect);

      for (let i = 0; i <= N; i++) {
        const y = topY + (i / N) * (bottomY - topY);
        const x_frac = i === 0 ? xD : (i === N ? xW : xD - (xD - xW) * i / N);
        const temp = estimateTemp(x_frac);
        const color = `hsl(${240 - (temp - 80) * 2}, 70%, 60%)`;

        const plate = document.createElementNS("http://www.w3.org/2000/svg", "rect");
        plate.setAttribute("x", towerX);
        plate.setAttribute("y", y - 2);
        plate.setAttribute("width", towerWidth);
        plate.setAttribute("height", 4);
        plate.setAttribute("fill", color);
        svg.appendChild(plate);

        if (i % 2 === 0) {
          const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
          text.setAttribute("x", towerX - 5);
          text.setAttribute("y", y + 4);
          text.setAttribute("font-size", "12");
          text.setAttribute("text-anchor", "end");
          text.textContent = `${temp.toFixed(0)}Â°C`;
          svg.appendChild(text);
        }
      }

      addRect(svg, towerX - 10, topY - 25, towerWidth + 20, 25, '#27ae60', '#d5f5e3');
      addText(svg, towerX + towerWidth/2, topY - 15, "å†·å‡å™¨", "middle", 12);
      addRect(svg, towerX - 10, bottomY + 5, towerWidth + 20, 25, '#e74c3c', '#fadbd8');
      addText(svg, towerX + towerWidth/2, bottomY + 20, "å†æ²¸å™¨", "middle", 12);
    }

    function drawTemperatureProfile(xD, xW) {
      const svg = document.getElementById('tempPlot');
      svg.innerHTML = '';
      svg.setAttribute('width', '300');
      svg.setAttribute('height', '300');
      
      const width = 300, height = 300;
      const margin = 45;
      const plotWidth = width - 2 * margin;
      const plotHeight = height - 2 * margin;

      const N = 10;
      let pathData = "M";
      for (let i = 0; i <= N; i++) {
        const x_frac = i === 0 ? xD : (i === N ? xW : xD - (xD - xW) * i / N);
        const temp = estimateTemp(x_frac);
        const x = margin + (i / N) * plotWidth;
        const y = height - margin - ((temp - 80) / 30) * plotHeight;
        pathData += ` ${x},${y}`;
      }

      const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
      path.setAttribute("d", pathData);
      path.setAttribute("fill", "none");
      path.setAttribute("stroke", "#e74c3c");
      path.setAttribute("stroke-width", "3");
      svg.appendChild(path);

      addLine(svg, margin, height - margin, margin, margin, 'black', null, 1.5);
      addLine(svg, margin, height - margin, width - margin, height - margin, 'black', null, 1.5);

      for (let t = 80; t <= 110; t += 10) {
        const y = height - margin - ((t - 80) / 30) * plotHeight;
        addLine(svg, margin - 8, y, margin, y, 'black', null, 1);
        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("x", margin - 12);
        text.setAttribute("y", y + 5);
        text.setAttribute("font-size", "13");
        text.setAttribute("text-anchor", "end");
        text.textContent = t;
        svg.appendChild(text);
      }
      addText(svg, margin - 15, margin + plotHeight/2, "æ¸©åº¦ (Â°C)", "middle", 14);
      addText(svg, margin + plotWidth/2, height - 10, "å¡”æ¿ä½ç½®", "middle", 14);
    }

    function drawPurityTrend() {
      const svg = document.getElementById('purityPlot');
      svg.innerHTML = '';
      svg.setAttribute('width', '300');
      svg.setAttribute('height', '300');
      
      const width = 300, height = 300;
      const margin = 45;
      const plotWidth = width - 2 * margin;
      const plotHeight = height - 2 * margin;

      if (history.length < 2) return;

      let xDPath = "M";
      let xWPath = "M";
      const maxTime = Math.max(10, history[history.length - 1].time);
      for (let i = 0; i < history.length; i++) {
        const t = history[i].time;
        const x = margin + (t / maxTime) * plotWidth;
        const yD = height - margin - history[i].xD * plotHeight;
        const yW = height - margin - history[i].xW * plotHeight;
        xDPath += ` ${x},${yD}`;
        xWPath += ` ${x},${yW}`;
      }

      addPath(svg, xDPath, "#3498db", 3);
      addPath(svg, xWPath, "#e74c3c", 3);

      addLine(svg, margin, height - margin, margin, margin, 'black', null, 1.5);
      addLine(svg, margin, height - margin, width - margin, height - margin, 'black', null, 1.5);

      for (let y = 0; y <= 1; y += 0.2) {
        const yPos = height - margin - y * plotHeight;
        addLine(svg, margin - 8, yPos, margin, yPos, 'black', null, 1);
        const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
        text.setAttribute("x", margin - 12);
        text.setAttribute("y", yPos + 5);
        text.setAttribute("font-size", "13");
        text.setAttribute("text-anchor", "end");
        text.textContent = y.toFixed(1);
        svg.appendChild(text);
      }

      addText(svg, margin - 18, margin + plotHeight/2, "çº¯åº¦", "middle", 14);
      addText(svg, margin + plotWidth/2, height - 10, "æ—¶é—´æ­¥", "middle", 14);

      addCircle(svg, width - 60, margin + 20, 6, "#3498db");
      addText(svg, width - 50, margin + 24, "x_D", "start", 13);
      addCircle(svg, width - 60, margin + 40, 6, "#e74c3c");
      addText(svg, width - 50, margin + 44, "x_W", "start", 13);
    }

    // === è¾…åŠ©ç»˜å›¾å‡½æ•° ===
    function addLine(svg, x1, y1, x2, y2, color, dash = null, width = 1) {
      const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
      line.setAttribute("x1", x1); line.setAttribute("y1", y1);
      line.setAttribute("x2", x2); line.setAttribute("y2", y2);
      line.setAttribute("stroke", color); line.setAttribute("stroke-width", width);
      if (dash) line.setAttribute("stroke-dasharray", dash);
      svg.appendChild(line);
    }
    function addRect(svg, x, y, w, h, stroke, fill) {
      const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
      rect.setAttribute("x", x); rect.setAttribute("y", y);
      rect.setAttribute("width", w); rect.setAttribute("height", h);
      if (stroke) rect.setAttribute("stroke", stroke);
      rect.setAttribute("fill", fill);
      svg.appendChild(rect);
    }
    function addCircle(svg, cx, cy, r, fill) {
      const c = document.createElementNS("http://www.w3.org/2000/svg", "circle");
      c.setAttribute("cx", cx); c.setAttribute("cy", cy); c.setAttribute("r", r);
      c.setAttribute("fill", fill);
      svg.appendChild(c);
    }
    function addPath(svg, d, stroke, width) {
      const p = document.createElementNS("http://www.w3.org/2000/svg", "path");
      p.setAttribute("d", d);
      p.setAttribute("fill", "none");
      p.setAttribute("stroke", stroke);
      p.setAttribute("stroke-width", width);
      svg.appendChild(p);
    }
    function addText(svg, x, y, txt, anchor = "start", size = 12) {
      const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
      t.setAttribute("x", x); t.setAttribute("y", y);
      t.setAttribute("font-size", size); t.setAttribute("text-anchor", anchor);
      t.textContent = txt;
      svg.appendChild(t);
    }

    // === UI æ§åˆ¶å‡½æ•° ===
    function updateStatus(xD, xW, alert) {
      const D = currentF * (currentZF - xW_set) / (xD_set - xW_set);
      const W = currentF - D;
      
      document.getElementById('statusInfo').innerHTML = 
        `å¡”é¡¶: <strong>${xD.toFixed(3)}</strong> | ` +
        `å¡”é‡œ: <strong>${xW.toFixed(3)}</strong><br>` +
        `<small>D: ${D.toFixed(1)} kmol/h | W: ${W.toFixed(1)} kmol/h | q: ${currentQfeed.toFixed(1)}</small>`;
    }

    function updateDashboard(Vt, Lt, Vb, Lb, eff, floodRisk, weirRisk) {
      document.getElementById('V_top').textContent = Vt.toFixed(1);
      document.getElementById('L_top').textContent = Lt.toFixed(1);
      document.getElementById('V_bot').textContent = Vb.toFixed(1);
      document.getElementById('L_bot').textContent = Lb.toFixed(1);
      document.getElementById('effValue').textContent = (eff * 100).toFixed(0) + '%';
      
      const topLoad = document.getElementById('rectTopLoad');
      const botLoad = document.getElementById('rectBotLoad');
      topLoad.innerHTML = `
        <div class="gauge-bar" style="width: ${Math.min(100, Vt/1.5)}%"></div>
        <div class="gauge-bar" style="width: ${Math.min(100, Lt/1.5)}%; background: linear-gradient(to right, #4caf50, #81c784); margin-top: 2px;"></div>
      `;
      botLoad.innerHTML = `
        <div class="gauge-bar" style="width: ${Math.min(100, Vb/1.5)}%"></div>
        <div class="gauge-bar" style="width: ${Math.min(100, Lb/1.5)}%; background: linear-gradient(to right, #ff9800, #ffb74d); margin-top: 2px;"></div>
      `;
      
      document.getElementById('effFill').style.width = (eff * 100) + '%';
      
      const floodEl = document.getElementById('floodRisk');
      const weirEl = document.getElementById('weirRisk');
      
      if (floodRisk > 0.85) {
        floodEl.textContent = 'æ¶²æ³›é£é™©';
        floodEl.className = 'status-light danger';
      } else if (floodRisk > 0.7) {
        floodEl.textContent = 'é«˜è´Ÿè·';
        floodEl.className = 'status-light warning';
      } else {
        floodEl.textContent = 'æ­£å¸¸';
        floodEl.className = 'status-light normal';
      }
      
      if (weirRisk < 0.3) {
        weirEl.textContent = 'æ¼æ¶²é£é™©';
        weirEl.className = 'status-light danger';
      } else if (weirRisk < 0.5) {
        weirEl.textContent = 'ä½è´Ÿè·';
        weirEl.className = 'status-light warning';
      } else {
        weirEl.textContent = 'æ­£å¸¸';
        weirEl.className = 'status-light normal';
      }
    }

    function resetOperation() {
      currentF = 100;
      currentZF = 0.5;
      currentR = 2.0;
      currentQ = 100;
      currentQfeed = 1.0;
      timeStep = 0;
      history = [];
      updateSliders();
      document.getElementById('statusInfo').textContent = "ç³»ç»Ÿå·²é‡ç½®ï¼Œå°±ç»ª";
      document.getElementById('alertBox').style.display = 'none';
      document.getElementById('tempPlot').innerHTML = '';
      document.getElementById('purityPlot').innerHTML = '';
      updateDashboard(0, 0, 0, 0, 0.85, 0, 0);
    }

    function updateSliders() {
      document.getElementById('FValue').textContent = currentF.toFixed(0);
      document.getElementById('zFValue').textContent = currentZF.toFixed(2);
      document.getElementById('RValue').textContent = currentR.toFixed(1);
      document.getElementById('QValue').textContent = currentQ.toFixed(0);
      document.getElementById('qValue').textContent = currentQfeed.toFixed(1);

      document.getElementById('F').value = currentF;
      document.getElementById('zF').value = currentZF;
      document.getElementById('R').value = currentR;
      document.getElementById('Q').value = currentQ;
      document.getElementById('qFeed').value = currentQfeed;
    }

    // æ»‘å—äº‹ä»¶
    document.getElementById('F').addEventListener('input', () => {
      currentF = parseFloat(document.getElementById('F').value);
      updateSliders();
    });
    document.getElementById('zF').addEventListener('input', () => {
      currentZF = parseFloat(document.getElementById('zF').value);
      updateSliders();
    });
    document.getElementById('R').addEventListener('input', () => {
      currentR = parseFloat(document.getElementById('R').value);
      updateSliders();
    });
    document.getElementById('Q').addEventListener('input', () => {
      currentQ = parseFloat(document.getElementById('Q').value);
      updateSliders();
    });
    document.getElementById('qFeed').addEventListener('input', () => {
      currentQfeed = parseFloat(document.getElementById('qFeed').value);
      updateSliders();
    });

    // === æ¨¡æ€æ¡†æ§åˆ¶å‡½æ•° ===
    function showInfoModal() {
      document.getElementById('infoModal').style.display = 'block';
    }

    function closeInfoModal() {
      document.getElementById('infoModal').style.display = 'none';
    }

    // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
    window.onclick = function(event) {
      const modal = document.getElementById('infoModal');
      if (event.target == modal) {
        modal.style.display = 'none';
      }
    }

    // åˆå§‹åŒ–
    resetOperation();
    drawTowerWithTemp(xD_set, xW_set);
  </script>
</body>
</html>